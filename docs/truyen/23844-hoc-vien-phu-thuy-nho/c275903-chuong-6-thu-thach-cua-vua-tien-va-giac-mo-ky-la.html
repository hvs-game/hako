<!DOCTYPE html>
<html lang="vi" class="light">
<head>
    <meta charset="utf-8">
    
    <title>Đọc Học Viện Phù Thủy Nhỏ - Chương 6: Thử Thách Của Vua Tiên Và Giấc Mơ Kỳ lạ - Cổng Light Novel - Đọc Light Novel</title>

    <meta name="description" content="Một câu chuyện nguyên tác dựa trên bộ anime đình đám! Để thực hiện ước mơ trở thành phù thủy, Atsuko Kagari đã không ngừng nỗ lực tại Học viện Ma pháp Luna Nova. Nhưng sau chuyến đi đến một ngọn đồi ma pháp—nơi được đồn là chốn ưa thích...">
    <meta name="theme-color" content="#000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="NgcK0pAbJUGT0v06ZXue1Ddj2yCEBjAz7POSXSuh">
    <meta name="logged-in" content="0">
    <meta property="fb:app_id" content="1864643850436909">

    <link rel="canonical" href="https://docln.net/truyen/23844-hoc-vien-phu-thuy-nho/c275903-chuong-6-thu-thach-cua-vua-tien-va-giac-mo-ky-la">
    <meta property="og:image" content="https://i.hako.vn/ln/series/covers/s23844-108ce68f-6349-46ff-a77d-11ad586fdc8d.jpg">


<style type="text/css">@font-face {font-family:Lora;font-style:normal;font-weight:400;src:url(/cf-fonts/v/lora/5.0.11/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Lora;font-style:normal;font-weight:400;src:url(/cf-fonts/v/lora/5.0.11/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Lora;font-style:normal;font-weight:400;src:url(/cf-fonts/v/lora/5.0.11/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Lora;font-style:normal;font-weight:400;src:url(/cf-fonts/v/lora/5.0.11/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Lora;font-style:normal;font-weight:400;src:url(/cf-fonts/v/lora/5.0.11/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Merriweather;font-style:normal;font-weight:400;src:url(/cf-fonts/s/merriweather/5.0.11/latin/400/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Merriweather;font-style:normal;font-weight:400;src:url(/cf-fonts/s/merriweather/5.0.11/cyrillic/400/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Merriweather;font-style:normal;font-weight:400;src:url(/cf-fonts/s/merriweather/5.0.11/vietnamese/400/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Merriweather;font-style:normal;font-weight:400;src:url(/cf-fonts/s/merriweather/5.0.11/latin-ext/400/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Merriweather;font-style:normal;font-weight:400;src:url(/cf-fonts/s/merriweather/5.0.11/cyrillic-ext/400/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/devanagari/wght/normal.woff2);unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FF;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/greek-ext/wght/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Nunito;font-style:normal;font-weight:400;src:url(/cf-fonts/v/nunito/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Nunito;font-style:normal;font-weight:400;src:url(/cf-fonts/v/nunito/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Nunito;font-style:normal;font-weight:400;src:url(/cf-fonts/v/nunito/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Nunito;font-style:normal;font-weight:400;src:url(/cf-fonts/v/nunito/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Nunito;font-style:normal;font-weight:400;src:url(/cf-fonts/v/nunito/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Roboto;font-style:normal;font-weight:400;src:url(/cf-fonts/s/roboto/5.0.11/vietnamese/400/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Roboto;font-style:normal;font-weight:400;src:url(/cf-fonts/s/roboto/5.0.11/cyrillic/400/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Roboto;font-style:normal;font-weight:400;src:url(/cf-fonts/s/roboto/5.0.11/latin-ext/400/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Roboto;font-style:normal;font-weight:400;src:url(/cf-fonts/s/roboto/5.0.11/cyrillic-ext/400/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Roboto;font-style:normal;font-weight:400;src:url(/cf-fonts/s/roboto/5.0.11/greek-ext/400/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Roboto;font-style:normal;font-weight:400;src:url(/cf-fonts/s/roboto/5.0.11/greek/400/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Roboto;font-style:normal;font-weight:400;src:url(/cf-fonts/s/roboto/5.0.11/latin/400/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}</style>
    <link rel="preload" href="/fonts/OpenSans-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preload" href="/fonts/OpenSans-SemiBold.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preconnect" href="https://www.google-analytics.com">

    <link rel="shortcut icon" href="/img/favicon.png?v=3">
    <link rel="apple-touch-icon" sizes="57x57" href="/img/apple-touch-icon.png?v=3">
    <link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png?v=3">
    <link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png?v=3">

    <link rel="stylesheet" href="/css/interface.css?id=300c3109a58d319c9bb94c8585835c77">
    <link rel="stylesheet" href="/css/tailwind.css?id=9128bdee617e5eb876ffd418ed3597bf">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css" integrity="sha256-BtbhCIbtfeVWGsqxk1vOHEYXS6qcvQvLMZqjtpWUEx8=" crossorigin="anonymous" />
            
    
    <script src="/scripts/plugins.js?id=b612d946b32459430eed3066ed15adf2"></script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-34864968-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
      gtag('config', 'UA-34864968-3');
    </script>
</head>

<body>
	
    <div x-data="{ open: Cookies.get('globalwarning2') === undefined ? true : false }">
    <div class="border-l-4 border-yellow-400 bg-yellow-50 p-4" x-show="open" style="display: none">
        <div class="flex">
            <div class="shrink-0">
                <button x-on:click="open = false; Cookies.set('globalwarning2', false, { expires: 0.5 })" type="button" class="inline-flex rounded-md bg-yellow-50 p-1.5 text-yellow-500 hover:bg-yellow-100 focus:outline-none focus:ring-2 focus:ring-yellow-600 focus:ring-offset-2 focus:ring-offset-yellow-50">
                    <span class="sr-only">Dismiss</span>
                    <svg class="size-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon">
                    <path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z" />
                    </svg>
                </button>
            </div>
            <div class="ml-3 font-bold">
                <p class="text-sm text-yellow-700">
                Nếu không thể <a class="font-medium text-blue-700" href="/thao-luan/2898-ten-mien-da-bi-chan">truy cập trang web</a> xin vui lòng sử dụng DNS 
                <a class="font-medium text-blue-700" href="https://www.google.com/search?q=c%C3%A1ch+c%C3%A0i+dns+1.1.1.1" target="_blank">1.1.1.1</a> hoặc <a class="font-medium text-blue-700" href="https://docln.sbs" target="_blank">docln.sbs</a>
                
                </p>
                <p>
                    <p class="text-sm text-orange-700">Hiện đang đứt cáp Internet APG, kết nối có thể chậm hoặc rất chậm. Dùng VPN không chắc có hiệu quả.</p>
                </p>
            </div>

        </div>
    </div>
</div>



	<style>
    body {
        background: inherit;
    }

    #footer {
        display: none;
    }
    
    .current-reading {
        background-color: rgba(189, 224, 254, 0.3);
        border-left: 5px solid #007bff;
        padding-left: 10px;
        transition: background-color 0.3s ease;
    }
</style>


<main id="mainpart" class="reading-page style-4">
    <section id="rd-side_icon" class="none force-block-l" aria-hidden="true">
                <a class="rd_sd-button_item rd_top-left" href="/truyen/23844-hoc-vien-phu-thuy-nho/c268415-chuong-5-tran-chien-giua-cait-sith-va-cu-sith"><i class="fas fa-backward"></i></a>
        
        <a class="rd_sd-button_item" href="/truyen/23844-hoc-vien-phu-thuy-nho"><i class="fas fa-home"></i></a>     
        <a id="rd-setting_icon" data-affect="#" class="rd_sd-button_item"><i class="fas fa-font"></i></a>
        <a id="rd-tts_icon" class="rd_sd-button_item"><i class="fas fa-volume-up"></i></a>
        <a id="rd-info_icon" data-affect="#rd_sidebar.chapters" class="rd_sd-button_item"><i class="fas fa-info"></i></a>
        <a id="rd-bookmark_icon" data-affect="#rd_sidebar.bookmarks" class="rd_sd-button_item"><i class="fas fa-bookmark"></i></a>

        
         
        <a class="rd_sd-button_item rd_top-right disabled"><i class="fas fa-forward"></i></a>
            </section>    
    
    <section id="chapters" class="rd_sidebar rdtoggle" aria-hidden="true">
        <main class="rdtoggle_body">
            <header class="rd_sidebar-header clear">
                <a class="img" href="/truyen/23844-hoc-vien-phu-thuy-nho/c275903-chuong-6-thu-thach-cua-vua-tien-va-giac-mo-ky-la" style="background: url('https://i.hako.vn/ln/series/covers/s23844-108ce68f-6349-46ff-a77d-11ad586fdc8d.jpg') no-repeat"></a> 
                <div class="rd_sidebar-name">                    
                    <h5><a href="/truyen/23844-hoc-vien-phu-thuy-nho">Học Viện Phù Thủy Nhỏ</a></h5>
                    <small><i class="fas fa-pen"></i>Momo Tachibana</small>
                    <small><i class="fas fa-paint-brush"></i>Eku Uekura</small>                
                </div>
            </header>

            <ul id="chap_list" class="unstyled">
                                                            <li class="current"><a href="/truyen/23844-hoc-vien-phu-thuy-nho/t34109-light-novel">Light Novel</a></li>
                        <ul class="sub-chap_list unstyled">
                                                        <li >
                                <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c249575-chuong-1-phu-thuy-vung-ve-khong-biet-cuoi-choi">
                                                                            <i class="fas fa-picture-o" aria-hidden="true" title="Có chứa ảnh"></i>
                                                                        Chương 1: Phù Thủy Vụng Về Không Biết Cưỡi Chổi
                                </a>
                            </li>
                                                        <li >
                                <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c250831-chuong-2-sifla-phu-thuy-canh-giu-doi-doras">
                                                                            <i class="fas fa-picture-o" aria-hidden="true" title="Có chứa ảnh"></i>
                                                                        Chương 2: Sifla, Phù Thủy Canh Giữ Đồi Doras
                                </a>
                            </li>
                                                        <li >
                                <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c252470-chuong-3-len-duong-den-xu-so-cua-cac-tien">
                                                                            <i class="fas fa-picture-o" aria-hidden="true" title="Có chứa ảnh"></i>
                                                                        Chương 3: Lên Đường Đến Xứ Sở Của Các Tiên!
                                </a>
                            </li>
                                                        <li >
                                <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c256639-chuong-4-feoras-la-vua-cua-cait-sith">
                                                                            <i class="fas fa-picture-o" aria-hidden="true" title="Có chứa ảnh"></i>
                                                                        Chương 4: Feoras là Vua Của Cait Sith?!
                                </a>
                            </li>
                                                        <li >
                                <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c268415-chuong-5-tran-chien-giua-cait-sith-va-cu-sith">
                                                                            <i class="fas fa-picture-o" aria-hidden="true" title="Có chứa ảnh"></i>
                                                                        Chương 5: Trận Chiến Giữa Cait Sith Và Cu Sith
                                </a>
                            </li>
                                                        <li  class="current" >
                                <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c275903-chuong-6-thu-thach-cua-vua-tien-va-giac-mo-ky-la">
                                                                            <i class="fas fa-picture-o" aria-hidden="true" title="Có chứa ảnh"></i>
                                                                        Chương 6: Thử Thách Của Vua Tiên Và Giấc Mơ Kỳ lạ
                                </a>
                            </li>
                                                    </ul>
                                        
                                        
            </ul>
        </main>
        <div class="black-click"></div>
    </section>
    
    <section id="bookmarks" class="rd_sidebar rdtoggle" aria-hidden="true">
        <main class="rdtoggle_body">
            <div class="rd_sidebar-header">
                <h2 class="rd_s-name"><i class="fas fa-bookmark"></i><a href="/bookmark" style="color: white;"> Bookmarks</a></h2>
            </div>
            <ul id="bookmarks_list" class="unstyled">
                                            <li>Bạn phải đăng nhập để sử dụng bookmark</li>
                                        </ul>
        </main>
        <div class="black-click"></div>
    </section>

    <section id="setting" class="rdtoggle" aria-hidden="true">
        <section class="re_set-in basic-section clear rdtoggle_body">
        <header class="sect-header"><span class="sect-title">Tùy chỉnh</span></header>
            <main class="sect-body">
                <div class="set-list set-color clear">
                    <label class="font-bold">Màu nền</label>
                    <div class="set-input clear justify-center">
                        <span data-color="#ffffff" data-id="0" style="background-color: #ffffff"></span>
                        <span data-color="#e6f0e6" data-id="1" style="background-color: #e6f0e6"></span>
                        <span data-color="#e3f5fa" data-id="2" style="background-color: #e3f5fa"></span>
                        <span data-color="#f6f4ec" data-id="3" style="background-color: #f6f4ec"></span>
                        <span data-color="#eae4d3" data-id="4" style="background-color: #eae4d3"></span>
                        <span data-color="#f5e9ef" data-id="5" style="background-color: #f5e9ef"></span>
                        <span data-color="#222222" data-id="6" style="background-color: #222222"></span>
                        <span data-color="#000000" data-id="7" style="background-color: #000000"></span>
                    </div>
                </div>
                <div class="set-list set-font-family clear">
                    <label class="font-bold">Font chữ</label>
                    <div class="set-slide set-input justify-center">    
                        <select>
                            <option>Times New Roman</option>
                            <option>Merriweather</option>
                            <option>Lora</option>
                            <option>Roboto</option>
                            <option>Noto Sans</option>
                            <option>Nunito</option>
                        </select>
                    </div>
                </div>
                <div class="set-list set-font clear">
                    <label class="font-bold">Kích cỡ chữ</label>
                    <div class="set-slide set-input justify-center">    
                        <span class="set-slide_button set-smaller"><i class="fas fa-chevron-left"></i></span>
                        <input class="set-slide_input" disabled="" value="16px" type="text">
                        <span class="set-bigger set-slide_button"><i class="fas fa-chevron-right"></i></span>
                    </div>
                </div>
                <div class="set-list set-margin clear">
                    <label class="font-bold">Bản lề</label>
                    <div class="set-slide set-input justify-center">
                        <span class="set-slide_button set-smaller"><i class="fas fa-chevron-left"></i></span>
                        <input class="set-slide_input" disabled="" value="20px" type="text">
                        <span class="set-bigger set-slide_button"><i class="fas fa-chevron-right"></i></span>
                    </div>
                </div>
                <div class="set-list set-text-align clear">
                    <label class="font-bold">Kiểu căn chỉnh</label>
                    <div class="set-input clear justify-center font-medium text-2xl flex flex-row gap-10">
                        <span data-align="text-left" class="p-1"><i class="fas fa-align-left"></i></span>
                        <span data-align="text-center" class="p-1"><i class="fas fa-align-center"></i></span>
                        <span data-align="text-right" class="p-1"><i class="fas fa-align-right"></i></span>
                        <span data-align="text-justify" class="p-1"><i class="fas fa-align-justify"></i></span>
                    </div>
                </div>
            </main>
        </section>
        <div class="black-click"></div>
    </section>

    <section id="tts-panel" class="rdtoggle" aria-hidden="true">
        <section class="tts-settings basic-section clear rdtoggle_body">
            <header class="sect-header"><span class="sect-title">Text-to-Speech</span></header>
            <main class="sect-body">
                <div class="set-list clear" style="color: red; font-size: 14px; margin-bottom: 20px">
                    Đây là chức năng đang thử nghiệm, chi tiết xem tại <a href="/thao-luan/3305-chuc-nang-doc" style="color: blue">Link</a>
                </div>
                <div class="set-list clear">
                    <label class="font-bold block mb-2">Giọng đọc</label>
                    <select id="tts-voice-select" class="w-full p-2 border rounded bg-white dark:bg-gray-800 text-sm dark:border-gray-600"></select>
                </div>
                <div class="set-list clear">
                    <label class="font-bold block mb-2">Tốc độ</label>
                    <div class="flex items-center space-x-2">
                        <input type="range" id="tts-rate" min="0.1" max="3" step="0.1" value="1" class="flex-1 w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500 dark:bg-gray-700 dark:accent-blue-400">
                        <span id="tts-rate-value" class="text-sm font-medium min-w-[3rem]">1.0</span>
                    </div>
                </div>
                <div class="set-list clear">
                    <label class="font-bold block mb-2">Độ cao (Pitch)</label>
                    <div class="flex items-center space-x-2">
                        <input type="range" id="tts-pitch" min="0" max="2" step="0.1" value="1" class="flex-1 w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500 dark:bg-gray-700 dark:accent-blue-400">
                        <span id="tts-pitch-value" class="text-sm font-medium min-w-[3rem]">1.0</span>
                    </div>
                </div>
                <div class="flex gap-2 pt-4">
                    <button id="tts-play-btn" class="flex-1 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-md">Phát</button>
                    <button id="tts-pause-btn" class="flex-1 bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-md">Tạm dừng</button>
                    <button id="tts-stop-btn" class="flex-1 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-md">Dừng</button>
                </div>
            </main>
        </section>
        <div class="black-click"></div>
    </section>
    
    <div class="container">
        <div class="row">
            <div class="reading-content col-12 col-lg-10 offset-lg-1" style="word-wrap: break-word;">
                <div id="bookmark_top" class="block d-lg-none"><i class="fas fa-bookmark"></i></div>
                <span class="save_bookmark" style="position: absolute; top: 9999px; display: none"><i class="fas fa-bookmark"></i></span>
                
                
                
                <div class="title-top" style="padding-top: 20px">
                    <h2 class="title-item text-xl font-bold" align="center">Light Novel</h2>
                    <h4 class="title-item text-base font-bold" align="center">Chương 6: Thử Thách Của Vua Tiên Và Giấc Mơ Kỳ lạ</h4>
                    <h6 class="title-item font-bold" align="center" aria-hidden="true">
                        <a href="https://docln.net/truyen/23844-hoc-vien-phu-thuy-nho/c275903-chuong-6-thu-thach-cua-vua-tien-va-giac-mo-ky-la#chapter-comments" style="text-decoration: underline">0 Bình luận</a> -
                        Độ dài: 3,297 từ - Cập nhật: 
                        <time class="topic-time timeago" title="20-12-2025 13:57:37" datetime="2025-12-20T13:57:37+07:00"></time>                    </h6>
                </div>

                <div style="text-align: center; margin: 20px auto -20px auto;">
                                                            
                </div>

                <div id="chapter-content" class="long-text no-select text-justify">
                    <p style="display: none">Chương 6: Thử Thách Của Vua Tiên Và Giấc Mơ Kỳ lạ</p>
                    <p id="1">Đứng trước Đá Doras, Feoras nhìn chúng tôi với gương mặt nghiêm nghị và hai tay vẫn khoanh lại. “Vậy là các cô thực sự nghiêm túc với chuyện này chứ?”</p><p id="2">“Tất nhiên rồi! Lời nói của tôi là danh dự.” Tôi tuyệt vọng kìm nén một tiếng cười đắc thắng.</p><p id="3"><em>Rất tiếc, không được để điều đó xảy ra. Nếu lúc này mình không cố tỏ ra ngoan ngoãn, chắc chắn họ sẽ nổi giận với mình.</em></p><p id="4"><em>Nhưng mà, ý mình là, thôi nào!</em></p><p id="5">Đây là một thử thách để trở thành vua tiên đấy, bạn biết mà.</p><p id="6">Chẳng phải việc tôi được tham gia là hoàn toàn tuyệt vời sao? Nếu tôi thực sự thành công, tôi có thể trở thành phù thủy đầu tiên cai trị giới tiên!</p><p id="7">Tôi tưởng tượng mình với chiếc vương miện trên đầu và chiếc áo choàng nặng trĩu khoác trên vai.</p><p id="8">Ồ, tôi đã có thể thấy Giáo sư Finnelan, Diana và những người còn lại đang cúi đầu trước mình! Trong khi đó, tôi sẽ đứng đó hiên ngang và kiêu hãnh.</p><p id="9">Eh-heh! Eh-heh-heh-heh-heh.</p><p id="10">“…Này, rõ rành rành là cậu đang nghĩ gì rồi đấy.” Amanda thì thầm vào tai tôi. “Đừng quên là chúng tôi cũng ở đây nữa.”</p><p id="11">“T—tôi biết mà!”</p><p id="12">Thấy chúng tôi không đủ nghiêm túc, Feoras thở dài một hơi sâu nhất từ trước đến nay. Về phần mình, Alan thực tế vẫn đang ngủ trên chiếc xe trượt.</p><p id="13">Trong cơn giận, Feoras không nương tay tung một cú đá vào lưng hắn. “Rồi sao?” Nó lạnh lùng nhìn xuống Alan, người đang nhìn lại nó một cách ngơ ngác.</p><p id="14">“‘Rồi sao’ là sao?”</p><p id="15">“Cậu đang âm mưu gì? Tôi biết cậu là một kẻ lười biếng vô dụng, kẻ thực tế sống chỉ để gây rắc rối cho người khác, nhưng cậu không phải loại người ngu ngốc đưa ra đề nghị mà không có lý do.”</p><p id="16">“Ồ, cậu đánh giá tôi cao quá đấy.” Alan trêu chọc. Môi hắn khẽ cong lên. “Hoặc đó là những gì tôi muốn nói, nhưng không gì có thể qua mắt được cậu, Feoras. Cậu hiểu tôi quá mà.”</p><p id="17">“Không phải do tôi muốn đâu, tôi cam đoan đấy.”</p><p id="18">“Các phù thủy, mọi người có thể lắng nghe tôi một chút không?” Lần đầu tiên, đôi mắt của Alan thực sự mở ra và tỉnh táo. “Nói ngắn gọn là, tôi ghét những thứ phiền phức.”</p><p id="19"><em>Ừ, đúng rồi, bọn mình cũng phần nào nhận ra điều đó.</em></p><p id="20">“Đó là lý do tại sao tôi nghĩ mình sẽ nhờ các cô giúp sức trong thử thách này.”</p><p id="21"><em>Hửm? Giúp đỡ? </em></p><p id="22">Chẳng phải chúng ta sẽ thi đấu sao?</p><p id="23">“Đó chỉ là cái cớ để nói với những con Cu Sith và Cait Sith khác thôi. Nếu tôi nói với họ rằng tôi muốn các cô giúp đỡ, chắc chắn họ sẽ phản đối.”</p><p id="24">“Cái gì cơ?!”</p><p id="25">“Chà, nghĩ mà xem. Suốt ba trăm năm qua chưa có ai thành công cả. Không đời nào chúng ta có thể tự mình làm được, đúng không?”</p><p id="26">“…! Tại sao, cậu—Cậu không có chút kiêu hãnh nào của một vị vua sao?!”</p><p id="27">“Không phải loại kiêu hãnh mà tôi phải tốn nhiều công sức để bảo vệ.”</p><p id="28">“Ch-chờ một chút.” Tôi xen vào. “Dừng lại đã. Chuyện này là sao? Ý anh là gì khi nói ‘chưa ai có thể thành công’?”</p><p id="29">“…Ghi chép về vị vua tiên đầu tiên đã có từ ba trăm năm trước. Người ta nói rằng không có trận chiến hay cuộc xung đột nào khi vị vua đó trị vì trên đồi, nhưng kể từ đó, chưa một ai hoàn thành thành công thử thách để trở thành người kế vị.”</p><p id="30">“Cái gìiiiiiiiiii—?!”</p><p id="31">“Thấy chưa? Nghe có vẻ khó, phải không? Không đời nào tôi có thể tìm ra cách để thực hiện nó.”</p><p id="32">“Tìm ra cách chính là cách để một ai đó trở thành vua tiên!”</p><p id="33">“Ừ, nhưng mà thôi. Nghiêm túc đấy, không có cách nào đâu.”</p><p id="34">“Trong trường hợp đó, hãy rút lui và nhường lại cho tôi!”</p><p id="35">“Nhưng tôi cũng không muốn làm thế.”</p><p id="36">Cả hai tiếp tục tranh cãi. (Chà, thành thật mà nói thì giống như Feoras đang hét vào mặt Alan hơn.) Và chúng tôi chỉ đứng đó, cực kỳ bối rối.</p><p id="37">“Cậu thật bướng bỉnh.” Alan khoanh tay, tự lẩm bẩm. “Hiện tại, sao chúng ta không quyết định ai sẽ là vua tiên sau khi đã thử sức nhỉ? Ý tôi là, tôi không nghĩ việc Cait Sith và Cu Sith giữ mối quan hệ xấu là một ý hay. Đó là lý do ngay từ đầu tôi đã đến để tham gia thử thách.”</p><p id="38">“Tôi không có ý định câu kết với bất cứ ai!”</p><p id="39">“Phải, phải, tôi biết rồi. Cậu cứ cố gắng hết sức một mình đi, Feoras. Tôi sẽ hợp lực với các phù thủy. Dù sao thì như thế cũng sẽ dễ dàng hơn.”</p><p id="40">Tôi nhìn Alan với vẻ hoàn toàn không thể tin nổi.</p><p id="41"><em>...Trời ạ, hắn thực sự lười hết mức có thể!</em></p><p id="42">“Tôi không thực sự quan tâm liệu mình có trở thành vua hay không. Nhưng sẽ là một vấn đề thực sự đấy, Feoras, nếu cậu thắng và cai trị tất cả chúng tôi. Nếu không còn cách nào khác, tôi dự định sẽ ngăn chặn điều đó xảy ra.”</p><p id="43">“…Đủ rồi. Bắt đầu thôi. Mọi người, hãy uống cái này.”</p><p id="44">Mà chúng tôi không nhận ra, ai đó đã chuẩn bị một bình thủy tinh trên chiếc bàn đá nhỏ trước Đá Doras. Nó chứa đầy một thứ chất lỏng màu hồng nhạt.</p><p id="45">“Cái gì đây?”</p><p id="46">“Một hỗn hợp được nấu từ lá của tất cả mười ba cái cây thiêng trong nước thánh. Nếu cô uống nó, người ta nói rằng sức mạnh của vua tiên sẽ đến trú ngụ trong cô.” Feoras vừa giải thích vừa rót đủ cho tất cả chúng tôi vào những chiếc ly nhỏ.</p><p id="47">Hừm. Khi đi vào chi tiết, Feoras thực sự rất giỏi trong việc chăm sóc người khác.</p><p id="48">Khi nó đưa ly cho tôi, tôi ghé mũi ngửi thử.</p><p id="49">Nó có một mùi hương kỳ lạ, như thể đủ loại gia vị đã được trộn lẫn với nhau... <em>Khoan đã, mình rút lại lời đó. Nó bắt đầu có mùi rất kỳ cục.</em></p><p id="50">“Cái này có ngon không?”</p><p id="51">“Làm sao tôi biết được? Đây là thức uống đặc biệt được truyền lại từ vị vua tiên đầu tiên. Đây là lần đầu tiên tôi nhìn thấy thứ thật.”</p><p id="52">“…Gớm quá. Vậy là anh đang bảo tôi rằng nó đã hơn ba trăm năm tuổi rồi sao? Anh có chắc là nó không bị hỏng không?” Tôi nín mũi, giữ chiếc ly càng xa mình càng tốt.</p><p id="53">Feoras thở dài trước khi trả lời, nhưng ngay cả điều đó cũng khiến nó có vẻ mệt mỏi. “Cô đúng là đầy rẫy những câu hỏi, phải không? Uống đi. Cô chắc chắn trông không có vẻ gì là yếu đuối đến mức nó có thể làm đau bụng cô đâu. Chỉ cần nhanh chóng uống nó đi.”</p><p id="54">“Anh không cần phải nói kiểu đó!”</p><p id="55"><em>Chẳng phải anh nên là một quý ông hào hiệp sao? Xin lỗi nhé, nhưng bản chất thật của anh đang lộ ra rồi đấy!</em></p><p id="56">“Được rồi, mọi người sẵn sàng chưa?” Sau khi kiểm tra để chắc chắn mỗi chúng tôi đều có một chiếc ly, Feoras đặt một tay lên hông. “Cạn ly!”</p><p id="57">Theo lệnh của nó, tất cả chúng tôi đều nâng ly rồi uống cạn thứ dung dịch đáng nghi bên trong.</p><p id="58"><em>...Wow! Đắng quá!</em></p><p id="59">Có lẽ họ đã đun lá quá lâu, vì nó nhầy nhụa, và... Oẹ, trời ạ, thứ này thực sự không ngon chút nào! Nó thật kinh tởm!</p><p id="60">“Urp.” Tôi lấy tay che miệng.</p><p id="61">Có lẽ vì tôi đã uống quá nhanh, tôi có thể cảm thấy thế giới bắt đầu quay cuồng, và suy nghĩ của tôi bắt đầu trở nên hỗn loạn, và tâm trí tôi ngày càng mờ mịt...</p><p id="62">Với bàn tay vẫn nắm chặt chiếc ly rỗng, tôi ngất đi trên mặt đất.</p><p id="63">...có chuyện gì vậy? Cô có sao không?</p><p id="64">Tôi tưởng mình đã nghe thấy một giọng nói khi mở mắt ra.</p><p id="65">Xung quanh tôi đen kịt, nên tôi không thể nhìn thấy ai, nhưng tôi chắc chắn có thể nghe thấy một người phụ nữ đang thì thầm.</p><p id="66">Không, khoan đã. Cô ấy đang sụt sùi hoặc đang khóc, nghe có vẻ rất đau khổ.</p><p id="67">Tôi lần mò trong bóng tối để tìm cô ấy, và chẳng bao lâu sau, tôi thấy một ánh sáng mờ nhạt và một người đang ngồi ở giữa đó.</p><p id="68">Đó là một cô gái trạc tuổi tôi với mái tóc bạc dài.</p><p id="69">Sifla?</p><p id="70">Tôi đoán đó không thể là cô bé được, phải không? Ý tôi là, cô bé vẫn mới chỉ sáu tuổi.</p><p id="71">Nhưng... tôi không thể rời mắt khỏi cô ấy. Cô ấy trông giống như một phiên bản trưởng thành của Sifla, lớn tuổi hơn, chín chắn và rất xinh đẹp.</p><p id="72">Trên đùi cô ấy, một con mèo kêu lên đau đớn, và cô ấy cố gắng dỗ dành nó, nhẹ nhàng vuốt ve đầu nó. Cuối cùng cô ấy cũng ngừng khóc.</p><p id="73">Hai người đã đánh nhau, phải không?</p><p id="74">Vừa nói, cô ấy vừa đặt bàn tay kia lên đầu một con chó lớn đang nằm cạnh mình. Nó hạ mí mắt trái đầy sẹo xuống và tiếp tục thở yếu ớt.</p><p id="75">Tôi sẽ chăm sóc cả hai người. Nhưng hãy hứa với tôi rằng hai người sẽ không đánh nhau nữa, được chứ?</p><p id="76">Dưới hơi ấm từ bàn tay cô ấy, vẻ mặt hung dữ của chúng dịu đi, và cô ấy nhìn xuống chúng với gương mặt dịu dàng và nhân từ như một thiên thần.</p><p id="77">Nếu bạn ở bên cạnh một ai đó, chẳng thà cùng nhau mỉm cười còn hơn là làm tổn thương nhau chứ?</p><p id="78">Khi cô ấy buồn bã thì thầm với chúng, con mèo và con chó lẳng lặng rúc vào gần cô ấy hơn.</p><p id="79">Tôi chỉ ngẩn ngơ nhìn họ, thẫn thờ, quên cả việc nói điều gì đó.</p><p id="80">“…Akko. Aaaakko!”</p><p id="81">Ai đó đang lay tôi mạnh bạo qua lại, và đôi mắt tôi mở ra lần nữa.</p><p id="82"><em>Ơ... Hả?</em></p><p id="83"><img src="https://i.hako.vn/ln/chapters/illusts/275903/53a18b1c-2805-4483-a956-4969518549cd.jpg" alt="b7d13154-b57a-4a9a-bf3d-337190d4f125.jpg"></p><p id="84">Trước mặt tôi, tôi thấy cô gái xinh đẹp đó. Không, khoan đã, chỉ là Sucy thôi.</p><p id="85">“Cậu thực sự có dây thần kinh thép đấy nhỉ, Akko? Sao cậu có thể lăn ra ngủ ngay lúc này được?”</p><p id="86">“Các cậu có thấy chuyện đó không?!”</p><p id="87">“Thấy gì cơ?” Cậu ấy nhíu mày, bối rối.</p><p id="88"><em>Đó là một giấc mơ sao?</em></p><p id="89">Có một cô gái trông rất giống Sifla.</p><p id="90">Cô ấy là ai chứ?</p><p id="91">Ngồi dậy, tôi nhận ra bùa hộ mệnh của cô bé đang tỏa sáng mờ nhạt trên cổ tay mình.</p><p id="92">...Tại sao chứ?</p><p id="93">“Ồ, tốt rồi. Akko, cậu là người duy nhất không chịu tỉnh dậy, và tớ đã không biết chúng ta phải làm gì nữa.” Lotte nói với một tiếng thở dài, buông lỏng đôi vai.</p><p id="94">“Ý cậu là tất cả mọi người đều ngất đi sao?”</p><p id="95">“Ừ, nhưng kiểu như chỉ trong một giây thôi. Tụi tớ không có bất tỉnh nhân sự như cậu đâu, Akko.”</p><p id="96">Khi Amanda trêu chọc tôi, bàn tay của Jasminka chìa ra từ bên cạnh cậu ấy.</p><p id="97">“Muốn ăn cáiii này khônggg?”</p><p id="98">“Hả?”</p><p id="99">“Đồ ngọt giúp ích cho việc thiếu máuuu.”</p><p id="100">“Ồ, được rồi. Cảm ơn nhé...”</p><p id="101">Tôi ăn chiếc bánh vòng phủ đường, ngọt lịm và ngon lành, và tôi có thể cảm thấy đầu óc mình ngày càng trở nên tỉnh táo hơn. Cuối cùng tôi cũng nhìn quanh một lượt.</p><p id="102">Chẳng có gì thay đổi cả, không có gì xung quanh chúng tôi, cũng không phải tôi.</p><p id="103">Nhưng Feoras đang lườm và cau mày nhìn cái bàn.</p><p id="104">“Có vẻ như thử thách đang diễn ra rồi đấy.” Amanda nói, mỉm cười và chỉ vào đó.</p><p id="105">Tôi ngó qua vai của tộc Cait Sith để xem... những chữ cái đang tỏa sáng mờ nhạt trên mặt bàn.</p><p id="106">Chà, chúng đã không ở đó một phút trước.</p><p id="107"><em>Ồ, đó là Bảng chữ cái Luna. Nó là, ừm... Cái này viết gì vậy?</em></p><p id="108">Khi tôi đứng đó bối rối, Feoras tỏ ra kinh ngạc.</p><p id="109">“Chẳng phải đọc Bảng chữ cái Luna là một kỹ năng cần thiết đối với phù thủy sao?”</p><p id="110">“Nghe này, tôi dở tệ khoản chữ viết cổ, được chưa?!”</p><p id="111">“Có việc gì mà cậu giỏi ngoài việc nói liến thoắng không? Cậu thậm chí còn không thể cưỡi chổi.”</p><p id="112">Amanda cười khẩy.</p><p id="113">“Không cưỡi chổi sao, hửm?” Đôi mắt ngái ngủ của Alan lại mở to lần nữa.</p><p id="114">Đột nhiên thấy tự ái, tôi cúi xuống và chọc hai đầu ngón tay trỏ vào nhau một cách bẽn lẽn. “Tôi chỉ là chưa luyện tập đủ thôi, thế thôi.”</p><p id="115">“K-kìa, thôi bỏ qua chuyện đó đi. Giờ nó không quan trọng, phải không?”</p><p id="116">Tôi luôn có thể trông cậy vào việc Lotte lên tiếng vào những lúc như thế này.</p><p id="117">“Đây là những gì nó viết<strong> ‘Kẻ nào hồi sinh những cái cây thiêng và khiến những ngôi sao rơi xuống từ thiên đường sẽ là người cai trị giới tiên.’</strong>”</p><p id="118">“Chỉ vậy thôi sao? Dễ ợt.” Amanda tự tin giơ gậy phép của mình lên bầu trời đêm.</p><p id="119"><strong>“Ea Lunag!”</strong></p><p id="120">Cô ấy niệm một câu thần chú sơ cấp, kêu gọi một vài ngôi sao băng.</p><p id="121">Nhưng không có lấy một tiếng động thoát ra từ cây gậy của cô ấy.</p><p id="122">“Hả? Lạ thật đấy.”</p><p id="123">Cô ấy triệu hồi chiếc chổi bằng một câu thần chú và nhảy lên nó, bay vút lên trời. Khi cô ấy lượn vòng trên đầu, cô ấy lại hét lên, to hơn trước.</p><p id="124"><strong>“Ea Lunag!”</strong></p><p id="125">Nhưng cũng giống như trước, chẳng có chuyện gì xảy ra cả.</p><p id="126">“Cái gì thế này?! Ma thuật ở đây cực kỳ yếu hay sao ấy?!”</p><p id="127">“Nếu đúng là vậy, cậu đã không thể bay lượn khắp nơi như thế, phải không?”</p><p id="128">Câu trả lời tỉnh táo của Sucy khiến Amanda nổi trận lôi đình. “Vậy tại sao câu thần chú không hoạt động?!” Bực bội, cô ấy bắt đầu đáp xuống mặt đất.</p><p id="129">“Có lẽ là vì đó không phải là câu trả lời đúng.” Feoras nhún vai.</p><p id="130">“Hả?”</p><p id="131">“Nếu chuyện này có thể giải quyết bằng thần chú của một phù thủy non nớt, thì ai đó đã làm từ lâu rồi. Thôi nào, chúng tôi không có ngốc đến thế. Sao cũng được. Phải hồi sinh những cái cây thiêng trước đã. Ít nhất thì đó là những gì văn tự viết.” Gắn khẳng định một cách hách dịch.</p><p id="132">Amanda nổi khùng. “Vậy thì anh thử làm đi. Anh làm được không? Hả?”</p><p id="133">“Tôi đang suy nghĩ đây.” Với vẻ mặt khó chịu, Feoras ngồi xuống ngay tại chỗ và khoanh chân lại. Chống khuỷu tay lên đùi, nó tựa cằm vào bàn chân và bắt đầu gõ nhẹ vào môi.</p><p id="134">“Cậu sẽ chẳng bao giờ làm được đâu. Ý tôi là, chúng ta thậm chí còn không sử dụng được ma thuật. Đó là lý do tại sao ngay từ đầu tôi đã đề nghị chúng ta mượn sức mạnh của họ đấy.” Alan uể oải nói, vẫn đang nằm dài.</p><p id="135">Cảnh tượng đó dường như chỉ càng làm Feoras thêm ngứa mắt. “Câm miệng! Tôi sẽ tự mình làm chuyện này!”</p><p id="136">“Ôi trời.” Alan nói khi nhìn tôi, nhưng hắn thực sự không có vẻ gì là lo lắng cả. Thực tế, trông hắn có vẻ đang khá thích thú. Có phải anh chàng này chỉ đang trêu chọc Feoras để mua vui cho mình không vậy?</p><p id="137">Dù không muốn nhưng tôi vẫn bật cười. “Hai người thực sự không hòa thuận với nhau sao?”</p><p id="138">“Chúng tôi không phải bạn bè. Nhưng chúng tôi đã sống cùng nhau một thời gian rất dài rồi. Khó mà tránh khỏi việc nảy sinh tình cảm gắn bó.”</p><p id="139">Thật lạ lùng. Cho đến một phút trước, tôi cứ nghĩ Feoras là người kiểm soát được mọi chuyện, nhưng giờ đây Alan lại có vẻ chín chắn hơn.</p><p id="140">“Feoras và tôi đã sống với Sifla tiền nhiệm từ khi cô ấy còn là một đứa trẻ, lúc chúng tôi được chọn làm ứng cử viên cho ngôi vị vua của tộc Cu Sith và Cait Sith. Rõ ràng, đó là một thỏa thuận giữa vị vua tiên đầu tiên và Sifla đời đầu... Tôi tự hỏi tại sao họ lại đưa ra một lời hứa kỳ lạ như vậy.” Hắn nghiêng đầu.</p><p id="141">“Anh đoán vị vua tiên đầu tiên là ai? Một Cu Sith hay một Cait Sith?” Tôi hỏi.</p><p id="142">“…Cait Sith, rõ ràng rồi.”</p><p id="143">Dĩ nhiên, câu trả lời lầm bầm đó đến từ Feoras.</p><p id="144">Alan nhún vai. Tôi có cảm giác việc tranh cãi đòi hỏi quá nhiều nỗ lực đối với hắn. “Chắc là vậy.”</p><p id="145">“Chà, kết quả là chúng tôi đã biết Sifla hiện tại từ khi con bé mới lọt lòng. Tôi nhận ra rằng những đứa trẻ loài người thật quá đỗi dễ thương. Bất cứ khi nào Feoras và tôi cãi nhau, con bé sẽ bắt đầu khóc ngay lập tức, cô biết đấy. Vì vậy, tất cả chúng tôi đã phải chung sống hòa thuận, ít nhất là ở vẻ bề ngoài.”</p><p id="146">“Nhưng anh muốn ngừng giả vờ và thực sự hòa thuận với Feoras, phải không?” Lotte cười khúc khích.</p><p id="147">Alan giả vờ không nghe thấy bằng cách ngáp một cái thật dài.</p><p id="148">Những người còn lại trong chúng tôi trao đổi ánh mắt. Rõ ràng, tất cả chúng tôi đều cảm thấy như vậy.</p><p id="149">“Trời ạ. Thế mà tôi cứ tưởng mình sẽ chớp lấy thời cơ nếu anh cho tôi một cơ hội nhỏ để trở thành vua tiên chứ.” Amanda thốt ra. Nhưng cô ấy mỉm cười.</p><p id="150">Alan ngước lên nhìn mặt chúng tôi và sủa một tiếng vui vẻ. “Vậy các cô sẽ hợp tác với tôi chứ?”</p><p id="151">“Chúng tôi không có nhiều sự lựa chọn. Ý tôi là, chúng tôi đến đây để giúp Sifla mà.”</p><p id="152">“Cảm ơn nhé. À, nói nãy giờ cũng bõ công. Tôi chưa bao giờ nói nhiều một lúc như thế này trước đây.”</p><p id="153">“Feoras, anh có đang nghe không? Mọi chuyện sẽ là như thế đấy!” Tôi gọi lớn.</p><p id="154">Nó vẫn bướng bỉnh quay lưng về phía chúng tôi, nhưng tôi có thể thấy nó đang thực sự kích động. Khi đứng dậy, cái đuôi của nó quất qua quất lại. “Akko, nếu cô và những người khác định đứng về phía Alan, thì cứ việc. Ngay cả khi tất cả các cô dồn hết chút kiến thức ít ỏi của mình lại, cũng chẳng thể làm nên chuyện gì đâu.”</p><p id="155">Chà, thật là khiếm nhã.</p><p id="156">“Trong trường hợp đó, chúng ta sẽ thi đấu để xem ai trong chúng ta có thể hồi sinh nhiều cây thiêng hơn. Chúng ta sẽ giải quyết chuyện những ngôi sao sau đó!” Nó hét lên.</p><p id="157">“Anh có chắc chắn là mình có thể tự làm tất cả những việc này một mình không?”</p><p id="158">“Tôi biết mình làm được! Đừng có đánh đồng tôi với Akko-Kẻ-Thất-Bại!”</p><p id="159"><em>Ôi, tha cho tôi đi. Giờ thì chẳng còn một chút dáng vẻ quý ông nào ở đó nữa rồi.</em></p><p id="160">Nhưng tất cả chúng tôi đều mỉm cười với nhau.</p><p id="161"><em>Trước tiên, hãy hồi sinh những cái cây thiêng đó nào!</em></p><p id="162"><em>...Vậy thì, ừm, chúng ta phải làm thế nào đây?</em></p>

                    <p style="display: none">Hãy bình luận để ủng hộ người đăng nhé!</p>
                    
                    <!-- <div class="flex justify-center mt-10 mb-7 space-x-3">
                        <a
                            href="https://hako.vn/discord"
                            target="_blank"
                            type="button"
                            data-te-ripple-init
                            data-te-ripple-color="light"
                            class="flex font-sans rounded px-6 py-2.5 text-xs font-medium uppercase leading-normal text-white shadow-md transition duration-150 ease-in-out hover:shadow-lg focus:shadow-lg focus:outline-none focus:ring-0 active:shadow-lg"
                            style="background-color: #7289da; text-decoration: initial; color: white !important;">
                            <svg
                                class="mr-2 h-4 w-4"
                                fill="currentColor"
                                xmlns="http://www.w3.org/2000/svg"
                                fill-rule="evenodd"
                                clip-rule="evenodd"
                                viewbox="0 0 24 24">
                                <path
                                d="M19.54 0c1.356 0 2.46 1.104 2.46 2.472v21.528l-2.58-2.28-1.452-1.344-1.536-1.428.636 2.22h-13.608c-1.356 0-2.46-1.104-2.46-2.472v-16.224c0-1.368 1.104-2.472 2.46-2.472h16.08zm-4.632 15.672c2.652-.084 3.672-1.824 3.672-1.824 0-3.864-1.728-6.996-1.728-6.996-1.728-1.296-3.372-1.26-3.372-1.26l-.168.192c2.04.624 2.988 1.524 2.988 1.524-1.248-.684-2.472-1.02-3.612-1.152-.864-.096-1.692-.072-2.424.024l-.204.024c-.42.036-1.44.192-2.724.756-.444.204-.708.348-.708.348s.996-.948 3.156-1.572l-.12-.144s-1.644-.036-3.372 1.26c0 0-1.728 3.132-1.728 6.996 0 0 1.008 1.74 3.66 1.824 0 0 .444-.54.804-.996-1.524-.456-2.1-1.416-2.1-1.416l.336.204.048.036.047.027.014.006.047.027c.3.168.6.3.876.408.492.192 1.08.384 1.764.516.9.168 1.956.228 3.108.012.564-.096 1.14-.264 1.74-.516.42-.156.888-.384 1.38-.708 0 0-.6.984-2.172 1.428.36.456.792.972.792.972zm-5.58-5.604c-.684 0-1.224.6-1.224 1.332 0 .732.552 1.332 1.224 1.332.684 0 1.224-.6 1.224-1.332.012-.732-.54-1.332-1.224-1.332zm4.38 0c-.684 0-1.224.6-1.224 1.332 0 .732.552 1.332 1.224 1.332.684 0 1.224-.6 1.224-1.332 0-.732-.54-1.332-1.224-1.332z" />
                            </svg>
                            Discord
                        </a>
                        <a
                            href="https://fb.com/hako.page"
                            target="_blank"
                            type="button"
                            data-te-ripple-init
                            data-te-ripple-color="light"
                            class="flex font-sans rounded px-6 py-2.5 text-xs font-medium uppercase leading-normal text-white shadow-md transition duration-150 ease-in-out hover:shadow-lg focus:shadow-lg focus:outline-none focus:ring-0 active:shadow-lg"
                            style="background-color: #1877f2; text-decoration: initial; color: white !important;">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="mr-2 h-4 w-4"
                                fill="currentColor"
                                viewBox="0 0 24 24">
                                <path
                                d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z" />
                            </svg>
                            Facebook
                        </a>
                    </div> -->

                                        <a href="/truyen/8476" target="__blank">
                        <img src="https://i.hako.vn/ln/series/chapter-banners/8476/3269685b-c0ef-4013-a7d6-74104f39a24c.jpg?t=1739894654" class="d-none d-md-block" style="width: 970px; height: auto">
                    </a>
                    <a href="/truyen/8476" target="__blank">
                        <img src="https://i.hako.vn/ln/series/chapter-banners/8476/bf1184be-cf52-429e-8acb-0d29fb4eea33.jpg?t=1739894654" class="d-md-none" style="width: 100%; height: auto">
                    </a>
                    
                                    </div>

                <div style="text-align: center; margin: 20px auto 10px auto;">
                                                        </div>
                
                <section class="rd-basic_icon row">
                    <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c268415-chuong-5-tran-chien-giua-cait-sith-va-cu-sith" class="dark:text-black col text-center "><i class="fas fa-backward"></i></a>
                    <a href="/truyen/23844-hoc-vien-phu-thuy-nho" class="dark:text-black col text-center"><i class="fas fa-home"></i></a>
                    <a href="/truyen/23844-hoc-vien-phu-thuy-nho" class="dark:text-black col text-center  disabled "><i class="fas fa-forward"></i></a>
                </section>
                
                <!--the code style is important to keep this comment section be out of the effect of user reading's setting-->
            </div>
            <div class="col-12 col-lg-10 offset-lg-1" aria-hidden="true">
                <section id="chapter-comments" class="basic-section dark:bg-[#1f1f1f] dark:text-white dark:border dark:border-[#1f1f1f]">
                    <header class="sect-header tab-list dark:bg-[#2a2a2a] dark:border-[#2a2a2a]"> 
                        <span class="sect-title tab-title" data-tab-index="1">Bình luận <span class="comments-count">(0)</span></span>
                    </header>
                    <main id="fbcmt_root" class="sect-body">
                        <span style="padding: 10px; display: inline-block;">Báo cáo bình luận không phù hợp ở <a href="/thao-luan/619-bao-cao-binh-luan" style="color: blue">đây</a></span>
                        <div id="tab-content-1" class="tab-content clear">
                            <section class="ln-comment">
    <header>
        <h3 class="text-lg font-bold dark:text-white">0 Bình luận </h3>
        <!-- <i id="refresh_comment" class="fas fa-refresh" aria-hidden="true" style="margin-left: 10px; font-size: 18px"></i></h3> -->
            </header>

    <main class="ln-comment-body">
                    <div class="ln-comment_sign-in long-text">
                Bạn phải <a href="/login">đăng nhập</a> hoặc <a href="/register">tạo tài khoản</a> để bình luận.
            </div>
                
        
        
        <div class="ln-comment-page">
</div>    </main>

    <script>
        var token = 'NgcK0pAbJUGT0v06ZXue1Ddj2yCEBjAz7POSXSuh';
        var comment_type = 'chapter';
        var comment_typeid = '275903';
    </script>

    </section>


                        </div>
                    </main>
                </section>
            </div> 
        </div>
    </div>
</main>

<script>
    token = 'NgcK0pAbJUGT0v06ZXue1Ddj2yCEBjAz7POSXSuh';
        
    function turnoffall() {
        $(".rdtoggle").removeClass("on");
        $(".rdtoggle_body").removeClass("animation fade-in-left-big fade-in-down");
        $("html").removeClass("overflow-hiden");
    }
    
    function rdtoggle(classicon, effect) {
        if ($(classicon).hasClass("on")) {
            turnoffall();
        } else {
            turnoffall();
            $(classicon).addClass("on");
            $("html").addClass("overflow-hiden");
            $(classicon + " .rdtoggle_body").addClass("animation " + effect);
        } 
    };
    
    $("#rd-setting_icon").on('click', function() {
        rdtoggle("#setting", "fade-in-down");                   
    });

    $("#rd-tts_icon").on('click', function() {
        rdtoggle("#tts-panel", "fade-in-down");
    });
        
    $("#rd-info_icon").on('click', function() {
        rdtoggle("#chapters", "fade-in-left-big");              
    });
        
    $("#rd-bookmark_icon").on('click', function() {
        rdtoggle("#bookmarks", "fade-in-left-big");                     
    });
        
    $(".black-click").on('click', function() {
        turnoffall();
        $("#rd-side_icon").hide();
        $("#bookmark_top").removeClass("on");
    });
        
    var bgcolor    = Cookies.get('color') || (Cookies.get('night_mode') ? 6 : 4);
    var fontfamily = Cookies.get('fontfamily') || '';
    var fontsize   = Cookies.get('font') || 18; 
    var margin     = Cookies.get('margin') || 0;
    var textAlign  = Cookies.get('textAlign') || 'text-justify';
        
    function setcolor(alter = true) {
        var switcher = $(".set-color .set-input span").eq(bgcolor);
        switcher.addClass("current");

        if (alter) {
            for (var i = 0; i < $(".set-color .set-input span").length; i++) {
                $("#mainpart").removeClass('style-' + i);
                $("#mainpart").removeClass('dark');
            }
            $("#mainpart").addClass('style-' + bgcolor);

            // Manually hardcoded to dark
            if (bgcolor >= 6) {
                $("#mainpart").addClass('dark');
            }
        }
    }

    // This creates unsmooth experience so we only use it for select box
    function setfontfamily() {
        $('.set-font-family select option').filter(function () {
            return fontfamily.split(',')[0].indexOf($(this).text()) != -1 ;
        }).attr('selected', true);
    }
        
    function setfontstyle(alter = true) {
        $(".set-font input.set-slide_input").val(fontsize + "px"); 

        if (alter) {
            $("div#chapter-content").css("font-size", fontsize + "px");

            var lineheight = +fontsize + 10;
            $("#chapter-content").css("line-height", lineheight + "px");
        }
    }
        
    function setmargin() {
        $(".set-margin input.set-slide_input").val(margin + "px"); 
        $("#chapter-content").css({
            'padding-left': margin + "px",
            'padding-right': margin + "px"
        });
    }

    function setTextAlign(alter = true) {
        var switcher = $(".set-text-align .set-input span[data-align='" + textAlign + "']");
        switcher.addClass("current");

        if (alter) {
            $(".set-text-align .set-input span").each(function () {
                $("#chapter-content").removeClass($(this).attr('data-align'));
            });

            $("#chapter-content").addClass(textAlign);
        }
    }
    
    setcolor(false);
    setfontfamily();
    setfontstyle(false);
    setmargin();
    setTextAlign(true);
    
    //1px = 0.0625rem;
    //16px = 1rem (default);
    
    $(".set-color .set-input span").click(function(){
        bgcolor = $(this).data("id");
        $(".set-color .set-input span").removeClass("current");
        setcolor();            
        Cookies.set('color', bgcolor, { expires: 365 });
    });

    $('.set-font-family select').on('change', function () {
        fontfamily = "'" + $('option:selected', this).text() + "', " + '\'Times New Roman\', Georgia, serif';
        
        $('div#chapter-content').css('font-family', fontfamily);

        Cookies.set('fontfamily', fontfamily, { expires: 365 });
    });
    
    $(".set-font .set-slide_button.set-smaller").click(function () {
        fontsize = fontsize - 2;
        if (fontsize < 0) fontsize = 0;
        setfontstyle();
        Cookies.set('font', fontsize, { expires: 365 });
    });
    
    $(".set-font .set-slide_button.set-bigger").click(function () {
        fontsize = +fontsize + 2;
        setfontstyle();
        Cookies.set('font', fontsize, { expires: 365 });
    });
    
    $(".set-margin .set-slide_button.set-smaller").click(function () {
        margin = margin - 20;
        if (margin < 0) margin = 0;
        setmargin();
        Cookies.set('margin', margin, { expires: 365 });
    });
    
    $(".set-margin .set-slide_button.set-bigger").click(function () {
        margin = +margin + 20;
        setmargin();
        Cookies.set('margin', margin, { expires: 365 });
    }); 

    $(".set-text-align .set-input span").click(function(){
        textAlign = $(this).data("align");
        $(".set-text-align .set-input span").removeClass("current");
        setTextAlign();        
        Cookies.set('textAlign', textAlign, { expires: 365 });
    });
        
    $("#bookmarks_list li").each(function(){
        var linepr = $(this).data("line");
        var preview = $(".reading-content p#" + linepr).text();

        var shortText = preview.trim().substring(0, 30) + "...";
        $(this).find(".pos_bookmark small").text(shortText);
    });

    $('div#chapter-content').html(
        $('div#chapter-content').html().replace(
            /\[note(\d+)\]/gi, 
            '<span id="anchor-note$1" class="note-icon none-print inline note-tooltip" data-tooltip-content="#note$1 .note-content" data-note-id="note$1"><i class="fas fa-sticky-note"></i></span><a id="anchor-note$1" class="inline-print none" href="#note$1">[note]</a>'
        )
    )
    
    tippy('.note-tooltip', {
        delay: 50,
        maxWidth: 240,
        interactive: true,
        content(ref) {
            const selector = ref.getAttribute('data-tooltip-content');
            const template = document.querySelector(selector);
            return template ? template.innerHTML : 'Đặt sai ID của note';
        }
    });
        
    isLoggedIn = 0;
    series_id = parseInt('23844');
    chapter_id = parseInt('275903');

    readingObject = {
        series_id: series_id,
        series_title: 'Học Viện Phù Thủy Nhỏ',
        series_url: $('i.fa-home').first().parent().attr('href'),
        series_cover: $('.rd_sidebar-header a.img').css('background-image'),
        chapter_title: $('ul.sub-chap_list li.current a').text().trim(),
        chapter_url: $('ul.sub-chap_list li.current a').attr('href'),
        book_title: $('ul#chap_list > li.current a').text(),
        book_url: $('ul#chap_list > li.current a').attr('href'),
        read_time: +new Date() / 1000 | 0,
    };

// TTS Manager - Enhanced Web Speech API (Vietnamese). Chunked queue for long texts, no delays/interrupts.
const synth = window.speechSynthesis;
let voices = [];
let voicesLoaded = false;
let ttsRate = parseFloat(localStorage.getItem('tts-rate')) || 1;
let ttsPitch = parseFloat(localStorage.getItem('tts-pitch')) || 1;
let ttsState = 'idle'; // idle, speaking, paused, loading
let currentChunk = 0;
let totalChunks = 0;
let processingIndex = 0;
let paragraphs = [];
const BUFFER_SIZE = 5;

// --- Background Persistence (Wake Lock + Silent Audio) ---
let wakeLock = null;
const silentAudio = new Audio('data:audio/mp3;base64,SUQzBAAAAAAAI1RTSVNFAAAAPAAADEVuY29kZWQgd2l0aCBMYW1lMy4xMDBhVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUA==');
silentAudio.loop = true;

async function enableConnection() {
    // 1. Start Silent Audio Loop (tricks browser into thinking we are a music player)
    try {
        await silentAudio.play();
    } catch (err) {
        console.warn('Silent Audio Play Failed (likely no interaction):', err);
    }

    // 2. Request Screen Wake Lock (prevents screen from sleeping automatically)
    if ('wakeLock' in navigator) {
        try {
            wakeLock = await navigator.wakeLock.request('screen');
        } catch (err) {
            console.warn('Wake Lock Request Failed:', err);
        }
    }
}

function disableConnection() {
    // 1. Stop Silent Audio
    try {
        silentAudio.pause();
        silentAudio.currentTime = 0;
    } catch (e) {}

    // 2. Release Wake Lock
    if (wakeLock) {
        try {
            wakeLock.release();
            wakeLock = null;
        } catch (e) {}
    }
}

// Re-acquire Wake Lock if visibility changes and we are speaking
document.addEventListener('visibilitychange', async () => {
    if (wakeLock !== null && document.visibilityState === 'visible' && ttsState === 'speaking') {
        try {
            wakeLock = await navigator.wakeLock.request('screen');
        } catch (e) {}
    }
});
// ---------------------------------------------------------

let ttsVoiceIdx = localStorage.getItem('tts-voice') || '0';

function populateVoices() {
    voices = synth.getVoices().filter(v => v.lang.startsWith('vi'));
    voicesLoaded = true;
    let $select = $('#tts-voice-select');
    $select.empty();

    if (voices.length === 0) {
        $select.append('<option value="-1">Không có giọng Việt (cài Chrome/Edge)</option>');
        return;
    }

    voices.forEach((voice, idx) => {
        $select.append(`<option value="${idx}">${voice.name} (${voice.lang}) ${voice.default ? '(mặc định)' : ''}</option>`);
    });

    let idx = Math.max(0, Math.min(parseInt(ttsVoiceIdx), voices.length - 1));
    $select.val(idx);
}

function updateTTSUI(progress = '') {
    let $icon = $('#rd-tts_icon i');
    $icon.removeClass('fa-volume-up fa-volume-mute fa-spinner fa-spin');
    let $playBtn = $('#tts-play-btn'), $pauseBtn = $('#tts-pause-btn'), $stopBtn = $('#tts-stop-btn');
    $playBtn.prop('disabled', ttsState === 'speaking' || ttsState === 'loading'); // Enable on idle/paused
    $pauseBtn.prop('disabled', ttsState === 'idle');
    $stopBtn.prop('disabled', ttsState === 'idle');
    // Always remove old progress
    $('#tts-progress').remove();

    if (progress && totalChunks > 0) {
        $playBtn.after(`<span id="tts-progress" class="text-xs block text-center mt-1">${progress}</span>`);
    }

    if (ttsState === 'idle') {
        // Check resume preview
        const resumeData = loadResumeState();
        let currentParagraphs = $('#chapter-content p').map(function() {
            return $(this).text().trim();
        }).get().filter(p => p.trim().length > 0);

        if (resumeData && resumeData.total === currentParagraphs.length) {
            $playBtn.text(`Tiếp tục (${resumeData.index + 1}/${resumeData.total})`);
        } else {
            $playBtn.text('Phát');
        }

        $icon.addClass('fa-volume-up');
    } else if (ttsState === 'speaking' || ttsState === 'loading') {
        $icon.addClass('fa-volume-up fa-spinner fa-spin');
    } else if (ttsState === 'paused') {
        $icon.addClass('fa-volume-mute');
    }
}

$('#tts-play-btn').off('click').on('click', function() {
    // Always restart/resume from storage
    enableConnection(); // Start keep-alive
    synth.cancel();
    ttsState = 'idle';
    // queuedUtterances = []; // Removed global queue
    currentChunk = 0;
    totalChunks = 0;
    processingIndex = 0;
    updateTTSUI();

    if (!voicesLoaded || voices.length === 0) {
        ttsState = 'loading';
        updateTTSUI();
        setTimeout(() => {
            if (!voicesLoaded) {
                alert('Giọng nói chưa tải. Thử lại.');
                ttsState = 'idle';
                updateTTSUI();
                return;
            }
            playTTS();
        }, 500);
        return;
    }

    playTTS();
});

function createUtterance(item) {
    let u = new SpeechSynthesisUtterance(item.text);
    u.lang = 'vi-VN';
    u.rate = parseFloat($('#tts-rate').val()) || 1;
    u.pitch = parseFloat($('#tts-pitch').val()) || 1;
    let voiceIdx = parseInt($('#tts-voice-select').val());

    if (voiceIdx >= 0 && voices[voiceIdx]) {
        u.voice = voices[voiceIdx];
    }

    u.onstart = () => {
        currentChunk++;
        saveResumeState();
        updateTTSUI(`${currentChunk}/${totalChunks}`);
        
        // Highlight logic
        $('.current-reading').removeClass('current-reading');
        if (item.el) {
            $(item.el).addClass('current-reading');
            item.el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        feedQueue(); // Ensure buffer is maintained
    };
    u.onerror = (event) => {
        console.error('TTS Error:', event.error, event);

        if (event.error !== 'interrupted') {
             // alert(`Lỗi TTS: ${event.error}. Bỏ qua đoạn.`);
             console.warn('TTS Error skipping chunk', event.error);
        }

        saveResumeState(); // Save on error
        feedQueue();
    };
    u.onend = () => {
        saveResumeState();

        if (currentChunk >= totalChunks) {
            clearResumeState();
            $('.current-reading').removeClass('current-reading'); // Cleanup
            
            // Auto-Next Logic
            let $nextBtn = $('.rd-basic_icon a').last();
            if ($nextBtn.length && !$nextBtn.hasClass('disabled')) {
                localStorage.setItem('tts-autoplay', 'true');
                window.location.href = $nextBtn.attr('href');
                return;
            }

            ttsState = 'idle';
            disableConnection(); // Cleanup
            currentChunk = 0;
            totalChunks = 0;
            processingIndex = 0;
            updateTTSUI();
        } else {
            feedQueue();
        }
    };
    u.onpause = () => { saveResumeState(); };
    return u;
}

function getStorageData() {
    try {
        return JSON.parse(localStorage.getItem('tts-resume-data')) || {};
    } catch {
        return {};
    }
}

function setStorageData(data) {
    localStorage.setItem('tts-resume-data', JSON.stringify(data));
}

function saveResumeState() {
    if (totalChunks > 0) {
        const data = getStorageData();
        data[chapter_id] = {
            index: currentChunk,
            total: totalChunks,
            timestamp: Date.now()
        };
        // Optional: Clean up old entries (older than 7 days?) to prevent infinite growth, 
        // but for now we just save.
        setStorageData(data);
    }
}

function clearResumeState() {
    const data = getStorageData();

    if (data[chapter_id]) {
        delete data[chapter_id];
        setStorageData(data);
    }
}

function loadResumeState() {
    const data = getStorageData();
    const saved = data[chapter_id];
    
    if (!saved) return null;
    
    if (Date.now() - saved.timestamp > 3600000 * 24 * 7) { // 7 days
        clearResumeState();
        return null;
    }

    return saved;
}

function initTTS() {
    populateVoices();
    $('#tts-rate').val(ttsRate);
    $('#tts-rate-value').text(ttsRate);
    $('#tts-pitch').val(ttsPitch);
    $('#tts-pitch-value').text(ttsPitch);
    updateTTSUI();
    
    if (localStorage.getItem('tts-autoplay') === 'true') {
        localStorage.removeItem('tts-autoplay');
        $(window).on('load', function() {
             setTimeout(() => {
                 $('#tts-play-btn').click(); 
             }, 500); 
        });
    }
}

function getParagraphs() {
    return $('#chapter-content p').map(function() {
        const text = $(this).text().trim();
        if (text.length > 0) {
            return { text: text, el: this };
        }
    }).get();
}

function feedQueue() {
    if (ttsState !== 'speaking') return;
    
    // Maintain buffer
    while (processingIndex < totalChunks && processingIndex < currentChunk + BUFFER_SIZE) {
        let u = createUtterance(paragraphs[processingIndex]);
        synth.speak(u);
        processingIndex++;
    }
}

function playTTS() {
    paragraphs = getParagraphs();
    if (paragraphs.length === 0) {
        alert('Không có nội dung để đọc.');
        ttsState = 'idle';
        disableConnection(); // Cleanup
        updateTTSUI();
        return;
    }
    
    const resumeData = loadResumeState();
    if (resumeData && resumeData.total === paragraphs.length) {
        currentChunk = resumeData.index;
        totalChunks = resumeData.total;
        // processingIndex needs to match what we are about to play
        // Current chunk is what finished, so we start processing from currentChunk?
        // Wait, currentChunk is "index of just finished" in some contexts?
        // No, in loadResume, index is currentChunk.
        // If saved index is 5. means 0..4 played.
        // We start playing from 5 (index).
        // So processingIndex = currentChunk.
        processingIndex = currentChunk;
    } else {
        clearResumeState();
        currentChunk = 0;
        totalChunks = paragraphs.length;
        processingIndex = 0;
    }
    
    synth.cancel();
    ttsState = 'speaking';
    
    feedQueue();
    updateTTSUI(`${currentChunk + 1}/${totalChunks}`);
}

$('#tts-rate').on('input', function() {
    $('#tts-rate-value').text(this.value);
    localStorage.setItem('tts-rate', this.value);
});

$('#tts-pitch').on('input', function() {
    $('#tts-pitch-value').text(this.value);
    localStorage.setItem('tts-pitch', this.value);
});

$('#tts-voice-select').on('change', function() {
    localStorage.setItem('tts-voice', this.value);
});

$('#tts-pause-btn').off('click').on('click', function() {
    if (ttsState === 'speaking') {
        synth.pause();
        ttsState = 'paused';
        disableConnection(); // Pause keep-alive
        updateTTSUI();
        saveResumeState();
    } else if (ttsState === 'paused') {
        enableConnection(); // Resume keep-alive
        synth.resume();
        ttsState = 'speaking';
        updateTTSUI();
    }
});

$('#tts-stop-btn').off('click').on('click', function() {
    synth.cancel();
    // clearResumeState(); // Stop doesn't necessarily clear resume, usually just pause? 
    // But UI says "Stop". Let's clear resume state to consistent with old behavior 
    // or maybe optional? Old behavior cleared it.
    clearResumeState();
    
    disableConnection(); // Stop keep-alive
    $('.current-reading').removeClass('current-reading'); // Cleanup
    ttsState = 'idle';
    currentChunk = 0;
    totalChunks = 0;
    processingIndex = 0;
    updateTTSUI();
});

// Visibility handler removed - TTS continues on tab switch

synth.onvoiceschanged = populateVoices;
initTTS();
</script>



    
    <script src="/scripts/service-manager.js?r=4"></script>

    <script src="/scripts/app.js?id=a5a24eca66adcfc75cc0b2f62e2611db"></script>
    <script src="https://docln.net/vendor/livewire/livewire.min.js?id=df3a17f2"   data-csrf="NgcK0pAbJUGT0v06ZXue1Ddj2yCEBjAz7POSXSuh" data-update-uri="/livewire/update" data-navigate-once="true"></script>

    
    <script
  type="text/javascript"
  src="https://disinheritguilewallow.com/d5/6b/4b/d56b4bd6c3d2c1e161c4ab3c78c27670.js"
  async
></script>

        
            <footer id="footer">
    <div class="container">
        <!--<span><a href="">Hako.re</a></span>-->
        <span class="right">Liên hệ: <a href="mailto:contact@hako.vn" target="_blank" style="color: #5fff46">contact@hako.vn</a></span>

        <span>© 2016 - 2025 Cổng Light Novel - Đọc Light Novel</span>
    </div>
</footer>    
    <div x-data x-show="$store.toast.on" @click="$store.toast.hide()" class="bg-teal-100 border-t-4 border-teal-500 rounded-b text-teal-900 px-4 py-3 shadow-md fixed w-3/4 md:w-1/2 z-20 inset-x-0 bottom-10 mx-auto" role="alert" style="display: none">
    <div class="flex">
        <div class="py-1"><svg class="fill-current h-6 w-6 text-teal-500 mr-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z"/></svg></div>
        <div>
            <p class="font-bold capitalize">Chú ý</p>
            <p class="text-sm" x-text="$store.toast.message"></p>
        </div>
    </div>
</div></body>
</html>
