<!DOCTYPE html>
<html lang="vi" class="light">
<head>
    <meta charset="utf-8">
    
    <title>Đọc Học Viện Phù Thủy Nhỏ - Lời bạt: Đêm Sao Rơi Phước Lành - Cổng Light Novel - Đọc Light Novel</title>

    <meta name="description" content="Một câu chuyện nguyên tác dựa trên bộ anime đình đám! Để thực hiện ước mơ trở thành phù thủy, Atsuko Kagari đã không ngừng nỗ lực tại Học viện Ma pháp Luna Nova. Nhưng sau chuyến đi đến một ngọn đồi ma pháp—nơi được đồn là chốn ưa thích...">
    <meta name="theme-color" content="#000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="TxxswE1PnG9nT2NvxUqJhcurQ8qtJDkK6eymON8a">
    <meta name="logged-in" content="0">
    <meta property="fb:app_id" content="1864643850436909">

    <link rel="canonical" href="https://docln.net/truyen/23844-hoc-vien-phu-thuy-nho/c297521-loi-bat-dem-sao-roi-phuoc-lanh">
    <meta property="og:image" content="https://i.hako.vn/ln/series/covers/s23844-108ce68f-6349-46ff-a77d-11ad586fdc8d.jpg">


<style type="text/css">@font-face {font-family:Lora;font-style:normal;font-weight:400;src:url(/cf-fonts/v/lora/5.0.11/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Lora;font-style:normal;font-weight:400;src:url(/cf-fonts/v/lora/5.0.11/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Lora;font-style:normal;font-weight:400;src:url(/cf-fonts/v/lora/5.0.11/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Lora;font-style:normal;font-weight:400;src:url(/cf-fonts/v/lora/5.0.11/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Lora;font-style:normal;font-weight:400;src:url(/cf-fonts/v/lora/5.0.11/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Merriweather;font-style:normal;font-weight:400;src:url(/cf-fonts/s/merriweather/5.0.11/latin-ext/400/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Merriweather;font-style:normal;font-weight:400;src:url(/cf-fonts/s/merriweather/5.0.11/cyrillic-ext/400/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Merriweather;font-style:normal;font-weight:400;src:url(/cf-fonts/s/merriweather/5.0.11/latin/400/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Merriweather;font-style:normal;font-weight:400;src:url(/cf-fonts/s/merriweather/5.0.11/cyrillic/400/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Merriweather;font-style:normal;font-weight:400;src:url(/cf-fonts/s/merriweather/5.0.11/vietnamese/400/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/devanagari/wght/normal.woff2);unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FF;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/greek-ext/wght/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Noto Sans;font-style:normal;font-weight:400;src:url(/cf-fonts/v/noto-sans/5.0.18/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Nunito;font-style:normal;font-weight:400;src:url(/cf-fonts/v/nunito/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Nunito;font-style:normal;font-weight:400;src:url(/cf-fonts/v/nunito/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Nunito;font-style:normal;font-weight:400;src:url(/cf-fonts/v/nunito/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Nunito;font-style:normal;font-weight:400;src:url(/cf-fonts/v/nunito/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Nunito;font-style:normal;font-weight:400;src:url(/cf-fonts/v/nunito/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Roboto;font-style:normal;font-weight:400;src:url(/cf-fonts/s/roboto/5.0.11/latin-ext/400/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Roboto;font-style:normal;font-weight:400;src:url(/cf-fonts/s/roboto/5.0.11/cyrillic-ext/400/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Roboto;font-style:normal;font-weight:400;src:url(/cf-fonts/s/roboto/5.0.11/cyrillic/400/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Roboto;font-style:normal;font-weight:400;src:url(/cf-fonts/s/roboto/5.0.11/greek/400/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Roboto;font-style:normal;font-weight:400;src:url(/cf-fonts/s/roboto/5.0.11/greek-ext/400/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Roboto;font-style:normal;font-weight:400;src:url(/cf-fonts/s/roboto/5.0.11/latin/400/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Roboto;font-style:normal;font-weight:400;src:url(/cf-fonts/s/roboto/5.0.11/vietnamese/400/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}</style>
    <link rel="preload" href="/fonts/OpenSans-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preload" href="/fonts/OpenSans-SemiBold.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preconnect" href="https://www.google-analytics.com">

    <link rel="shortcut icon" href="/img/favicon.png?v=3">
    <link rel="apple-touch-icon" sizes="57x57" href="/img/apple-touch-icon.png?v=3">
    <link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png?v=3">
    <link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png?v=3">

    <link rel="stylesheet" href="/css/interface.css?id=300c3109a58d319c9bb94c8585835c77">
    <link rel="stylesheet" href="/css/tailwind.css?id=79c8956531b276c6564b6dfd12d504f8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css" integrity="sha256-BtbhCIbtfeVWGsqxk1vOHEYXS6qcvQvLMZqjtpWUEx8=" crossorigin="anonymous" />
            
    
    <script src="/scripts/plugins.js?id=b612d946b32459430eed3066ed15adf2"></script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-34864968-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
      gtag('config', 'UA-34864968-3');
    </script>
</head>

<body>
	
    <div x-data="{ open: Cookies.get('globalwarning2') === undefined ? true : false }">
    <div class="border-l-4 border-yellow-400 bg-yellow-50 p-4" x-show="open" style="display: none">
        <div class="flex">
            <div class="shrink-0">
                <button x-on:click="open = false; Cookies.set('globalwarning2', false, { expires: 0.5 })" type="button" class="inline-flex rounded-md bg-yellow-50 p-1.5 text-yellow-500 hover:bg-yellow-100 focus:outline-none focus:ring-2 focus:ring-yellow-600 focus:ring-offset-2 focus:ring-offset-yellow-50">
                    <span class="sr-only">Dismiss</span>
                    <svg class="size-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon">
                    <path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z" />
                    </svg>
                </button>
            </div>
            <div class="ml-3 font-bold">
                <p class="text-sm text-yellow-700">
                Nếu không thể <a class="font-medium text-blue-700" href="/thao-luan/2898-ten-mien-da-bi-chan">truy cập trang web</a> xin vui lòng sử dụng DNS 
                <a class="font-medium text-blue-700" href="https://www.google.com/search?q=c%C3%A1ch+c%C3%A0i+dns+1.1.1.1" target="_blank">1.1.1.1</a> hoặc <a class="font-medium text-blue-700" href="https://docln.sbs" target="_blank">docln.sbs</a>
                
                </p>
                <p>
                    <p class="text-sm text-orange-700">Hiện đang đứt cáp Internet APG, kết nối có thể chậm hoặc rất chậm. Dùng VPN không chắc có hiệu quả.</p>
                </p>
            </div>

        </div>
    </div>
</div>



	<style>
    body {
        background: inherit;
    }

    #footer {
        display: none;
    }
    
    .current-reading {
        background-color: rgba(189, 224, 254, 0.3);
        border-left: 5px solid #007bff;
        padding-left: 10px;
        transition: background-color 0.3s ease;
    }
</style>


<main id="mainpart" class="reading-page style-4">
    <section id="rd-side_icon" class="none force-block-l" aria-hidden="true">
                <a class="rd_sd-button_item rd_top-left" href="/truyen/23844-hoc-vien-phu-thuy-nho/c297517-chuong-8-mot-sai-lam-tai-hai-va-mot-con-thinh-no-khung-khiep"><i class="fas fa-backward"></i></a>
        
        <a class="rd_sd-button_item" href="/truyen/23844-hoc-vien-phu-thuy-nho"><i class="fas fa-home"></i></a>     
        <a id="rd-setting_icon" data-affect="#" class="rd_sd-button_item"><i class="fas fa-font"></i></a>
        <a id="rd-tts_icon" class="rd_sd-button_item"><i class="fas fa-volume-up"></i></a>
        <a id="rd-info_icon" data-affect="#rd_sidebar.chapters" class="rd_sd-button_item"><i class="fas fa-info"></i></a>
        <a id="rd-bookmark_icon" data-affect="#rd_sidebar.bookmarks" class="rd_sd-button_item"><i class="fas fa-bookmark"></i></a>

        
         
        <a class="rd_sd-button_item rd_top-right disabled"><i class="fas fa-forward"></i></a>
            </section>    
    
    <section id="chapters" class="rd_sidebar rdtoggle" aria-hidden="true">
        <main class="rdtoggle_body">
            <header class="rd_sidebar-header clear">
                <a class="img" href="/truyen/23844-hoc-vien-phu-thuy-nho/c297521-loi-bat-dem-sao-roi-phuoc-lanh" style="background: url('https://i.hako.vn/ln/series/covers/s23844-108ce68f-6349-46ff-a77d-11ad586fdc8d.jpg') no-repeat"></a> 
                <div class="rd_sidebar-name">                    
                    <h5><a href="/truyen/23844-hoc-vien-phu-thuy-nho">Học Viện Phù Thủy Nhỏ</a></h5>
                    <small><i class="fas fa-pen"></i>Momo Tachibana</small>
                    <small><i class="fas fa-paint-brush"></i>Eku Uekura</small>                
                </div>
            </header>

            <ul id="chap_list" class="unstyled">
                                                            <li class="current"><a href="/truyen/23844-hoc-vien-phu-thuy-nho/t34109-light-novel">Light Novel</a></li>
                        <ul class="sub-chap_list unstyled">
                                                        <li >
                                <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c249575-chuong-1-phu-thuy-vung-ve-khong-biet-cuoi-choi">
                                                                            <i class="fas fa-picture-o" aria-hidden="true" title="Có chứa ảnh"></i>
                                                                        Chương 1: Phù Thủy Vụng Về Không Biết Cưỡi Chổi
                                </a>
                            </li>
                                                        <li >
                                <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c250831-chuong-2-sifla-phu-thuy-canh-giu-doi-doras">
                                                                            <i class="fas fa-picture-o" aria-hidden="true" title="Có chứa ảnh"></i>
                                                                        Chương 2: Sifla, Phù Thủy Canh Giữ Đồi Doras
                                </a>
                            </li>
                                                        <li >
                                <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c252470-chuong-3-len-duong-den-xu-so-cua-cac-tien">
                                                                            <i class="fas fa-picture-o" aria-hidden="true" title="Có chứa ảnh"></i>
                                                                        Chương 3: Lên Đường Đến Xứ Sở Của Các Tiên!
                                </a>
                            </li>
                                                        <li >
                                <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c256639-chuong-4-feoras-la-vua-cua-cait-sith">
                                                                            <i class="fas fa-picture-o" aria-hidden="true" title="Có chứa ảnh"></i>
                                                                        Chương 4: Feoras là Vua Của Cait Sith?!
                                </a>
                            </li>
                                                        <li >
                                <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c268415-chuong-5-tran-chien-giua-cait-sith-va-cu-sith">
                                                                            <i class="fas fa-picture-o" aria-hidden="true" title="Có chứa ảnh"></i>
                                                                        Chương 5: Trận Chiến Giữa Cait Sith Và Cu Sith
                                </a>
                            </li>
                                                        <li >
                                <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c275903-chuong-6-thu-thach-cua-vua-tien-va-giac-mo-ky-la">
                                                                            <i class="fas fa-picture-o" aria-hidden="true" title="Có chứa ảnh"></i>
                                                                        Chương 6: Thử Thách Của Vua Tiên Và Giấc Mơ Kỳ lạ
                                </a>
                            </li>
                                                        <li >
                                <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c293625-chuong-7-hoi-sinh-nhung-cay-thieng">
                                                                            <i class="fas fa-picture-o" aria-hidden="true" title="Có chứa ảnh"></i>
                                                                        Chương 7: Hồi Sinh Những Cây Thiêng
                                </a>
                            </li>
                                                        <li >
                                <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c297517-chuong-8-mot-sai-lam-tai-hai-va-mot-con-thinh-no-khung-khiep">
                                                                            <i class="fas fa-picture-o" aria-hidden="true" title="Có chứa ảnh"></i>
                                                                        Chương 8: Một Sai Lầm Tai Hại Và Một Cơn Thịnh Nộ Khủng Khiếp!
                                </a>
                            </li>
                                                        <li  class="current" >
                                <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c297521-loi-bat-dem-sao-roi-phuoc-lanh">
                                                                            <i class="fas fa-picture-o" aria-hidden="true" title="Có chứa ảnh"></i>
                                                                        Lời bạt: Đêm Sao Rơi Phước Lành
                                </a>
                            </li>
                                                    </ul>
                                        
                                        
            </ul>
        </main>
        <div class="black-click"></div>
    </section>
    
    <section id="bookmarks" class="rd_sidebar rdtoggle" aria-hidden="true">
        <main class="rdtoggle_body">
            <div class="rd_sidebar-header">
                <h2 class="rd_s-name"><i class="fas fa-bookmark"></i><a href="/bookmark" style="color: white;"> Bookmarks</a></h2>
            </div>
            <ul id="bookmarks_list" class="unstyled">
                                            <li>Bạn phải đăng nhập để sử dụng bookmark</li>
                                        </ul>
        </main>
        <div class="black-click"></div>
    </section>

    <section id="setting" class="rdtoggle" aria-hidden="true">
        <section class="re_set-in basic-section clear rdtoggle_body">
        <header class="sect-header"><span class="sect-title">Tùy chỉnh</span></header>
            <main class="sect-body">
                <div class="set-list set-color clear">
                    <label class="font-bold">Màu nền</label>
                    <div class="set-input clear justify-center">
                        <span data-color="#ffffff" data-id="0" style="background-color: #ffffff"></span>
                        <span data-color="#e6f0e6" data-id="1" style="background-color: #e6f0e6"></span>
                        <span data-color="#e3f5fa" data-id="2" style="background-color: #e3f5fa"></span>
                        <span data-color="#f6f4ec" data-id="3" style="background-color: #f6f4ec"></span>
                        <span data-color="#eae4d3" data-id="4" style="background-color: #eae4d3"></span>
                        <span data-color="#f5e9ef" data-id="5" style="background-color: #f5e9ef"></span>
                        <span data-color="#222222" data-id="6" style="background-color: #222222"></span>
                        <span data-color="#000000" data-id="7" style="background-color: #000000"></span>
                    </div>
                </div>
                <div class="set-list set-font-family clear">
                    <label class="font-bold">Font chữ</label>
                    <div class="set-slide set-input justify-center">    
                        <select>
                            <option>Times New Roman</option>
                            <option>Merriweather</option>
                            <option>Lora</option>
                            <option>Roboto</option>
                            <option>Noto Sans</option>
                            <option>Nunito</option>
                        </select>
                    </div>
                </div>
                <div class="set-list set-font clear">
                    <label class="font-bold">Kích cỡ chữ</label>
                    <div class="set-slide set-input justify-center">    
                        <span class="set-slide_button set-smaller"><i class="fas fa-chevron-left"></i></span>
                        <input class="set-slide_input" disabled="" value="16px" type="text">
                        <span class="set-bigger set-slide_button"><i class="fas fa-chevron-right"></i></span>
                    </div>
                </div>
                <div class="set-list set-margin clear">
                    <label class="font-bold">Bản lề</label>
                    <div class="set-slide set-input justify-center">
                        <span class="set-slide_button set-smaller"><i class="fas fa-chevron-left"></i></span>
                        <input class="set-slide_input" disabled="" value="20px" type="text">
                        <span class="set-bigger set-slide_button"><i class="fas fa-chevron-right"></i></span>
                    </div>
                </div>
                <div class="set-list set-text-align clear">
                    <label class="font-bold">Kiểu căn chỉnh</label>
                    <div class="set-input clear justify-center font-medium text-2xl flex flex-row gap-10">
                        <span data-align="text-left" class="p-1"><i class="fas fa-align-left"></i></span>
                        <span data-align="text-center" class="p-1"><i class="fas fa-align-center"></i></span>
                        <span data-align="text-right" class="p-1"><i class="fas fa-align-right"></i></span>
                        <span data-align="text-justify" class="p-1"><i class="fas fa-align-justify"></i></span>
                    </div>
                </div>
            </main>
        </section>
        <div class="black-click"></div>
    </section>

    <section id="tts-panel" class="rdtoggle" aria-hidden="true">
        <section class="tts-settings basic-section clear rdtoggle_body">
            <header class="sect-header"><span class="sect-title">Text-to-Speech</span></header>
            <main class="sect-body">
                <div class="set-list clear" style="color: red; font-size: 14px; margin-bottom: 20px">
                    Đây là chức năng đang thử nghiệm, chi tiết xem tại <a href="/thao-luan/3305-chuc-nang-doc" style="color: blue">Link</a>
                </div>
                <div class="set-list clear">
                    <label class="font-bold block mb-2">Giọng đọc</label>
                    <select id="tts-voice-select" class="w-full p-2 border rounded bg-white dark:bg-gray-800 text-sm dark:border-gray-600"></select>
                </div>
                <div class="set-list clear">
                    <label class="font-bold block mb-2">Tốc độ</label>
                    <div class="flex items-center space-x-2">
                        <input type="range" id="tts-rate" min="0.1" max="3" step="0.1" value="1" class="flex-1 w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500 dark:bg-gray-700 dark:accent-blue-400">
                        <span id="tts-rate-value" class="text-sm font-medium min-w-[3rem]">1.0</span>
                    </div>
                </div>
                <div class="set-list clear">
                    <label class="font-bold block mb-2">Độ cao (Pitch)</label>
                    <div class="flex items-center space-x-2">
                        <input type="range" id="tts-pitch" min="0" max="2" step="0.1" value="1" class="flex-1 w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500 dark:bg-gray-700 dark:accent-blue-400">
                        <span id="tts-pitch-value" class="text-sm font-medium min-w-[3rem]">1.0</span>
                    </div>
                </div>
                <div class="flex gap-2 pt-4">
                    <button id="tts-play-btn" class="flex-1 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-md">Phát</button>
                    <button id="tts-pause-btn" class="flex-1 bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-md">Tạm dừng</button>
                    <button id="tts-stop-btn" class="flex-1 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-md">Dừng</button>
                </div>
            </main>
        </section>
        <div class="black-click"></div>
    </section>
    
    <div class="container">
        <div class="row">
            <div class="reading-content col-12 col-lg-10 offset-lg-1" style="word-wrap: break-word;">
                <div id="bookmark_top" class="block d-lg-none"><i class="fas fa-bookmark"></i></div>
                <span class="save_bookmark" style="position: absolute; top: 9999px; display: none"><i class="fas fa-bookmark"></i></span>
                
                
                
                <div class="title-top" style="padding-top: 20px">
                    <h2 class="title-item text-xl font-bold" align="center">Light Novel</h2>
                    <h4 class="title-item text-base font-bold" align="center">Lời bạt: Đêm Sao Rơi Phước Lành</h4>
                    <h6 class="title-item font-bold" align="center" aria-hidden="true">
                        <a href="https://docln.net/truyen/23844-hoc-vien-phu-thuy-nho/c297521-loi-bat-dem-sao-roi-phuoc-lanh#chapter-comments" style="text-decoration: underline">0 Bình luận</a> -
                        Độ dài: 2,865 từ - Cập nhật: 
                        <time class="topic-time timeago" title="26-01-2026 13:53:16" datetime="2026-01-26T13:53:16+07:00"></time>                    </h6>
                </div>

                <div style="text-align: center; margin: 20px auto -20px auto;">
                                                        </div>

                <div class="pt-6 mb-6 mx-auto max-w-4xl" x-data="{ open: Cookies.get('affiliation_popup_closed2') === undefined }" x-cloak>
                    <div id="affiliation-popup" x-show="open" style="display: none" class="bg-slate-900 rounded-xl overflow-hidden shadow-lg border !border-slate-800">
                        <div class="p-4 flex flex-col md:flex-row items-center gap-4">
                            <button x-on:click="open = false; Cookies.set('affiliation_popup_closed2', 'true', { expires: 0.5 })" class="text-gray-400 hover:text-white transition-colors p-2" aria-label="Close">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                            
                            <div class="flex-shrink-0">
                                <img src="https://i2.hako.vip/vault/992471336465223711.webp" alt="Pepe" class="w-16 h-16 rounded-md object-cover">
                            </div>

                            <div class="flex-grow text-center md:text-left">
                                <p class="text-white text-sm md:text-base font-medium">
                                    Click vào link khi MUA <span class="text-orange-500 font-bold uppercase">BẤT KỲ THỨ GÌ</span> trên <span class="text-orange-500 font-bold">Shopee</span> để hỗ trợ HAKO. Có thể được tặng mã Free ship khi mua.
                                </p>
                            </div>

                            <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto flex-shrink-0">
                                <a href="https://s.shopee.vn/4q9eci0DM3" target="_blank" class="flex-1 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-bold py-2 px-6 rounded shadow-md transition-all text-center whitespace-nowrap" rel="noopener noreferrer">
                                    Shopee
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="chapter-content" class="long-text no-select text-justify">
                    <p style="display: none">Lời bạt: Đêm Sao Rơi Phước Lành</p>
                    <p id="1">“Tôi xin lỗi.” Feoras khép nép cúi đầu.</p><p id="2">Nó không còn ra vẻ là một vị vua của tộc Cait Sith nữa. Nó phủ phục bằng cả bốn chân, giống như một con mèo bình thường.</p><p id="3">“Có vẻ tôi đã quá bướng bỉnh... Điều đó hẳn đã làm Sifla đời đầu nổi giận. Đó chắc chắn là lý do cô ấy biến chúng ta thành những thứ đó. Cô ấy muốn nói rằng ‘Nếu các bạn muốn quyền lực đến thế, thì hãy chiến đấu với nhau mãi mãi đi’.”</p><p id="4">Alan cũng cúi đầu đồng tình, trông chẳng khác gì một chú chó bình thường. “Lẽ ra tôi nên đối mặt trực diện với cậu, Feoras. Lẽ ra tôi nên yêu cầu chúng ta dừng lại, thay vì cứ nghĩ rằng việc đó quá phiền phức.”</p><p id="5">“Không, cả hai đều sai rồi. Đó là lỗi của tớ vì đã không thể trở thành một phù thủy đúng nghĩa.” Đôi mắt ngập tràn nước mắt, Sifla ôm chặt lấy cặp đôi đang chán nản. “Đó là lý do tớ không thể nghe thấy tiếng nói của hai cậu. Tớ đã không thực sự cố gắng lắng nghe. Tớ là một người bảo hộ thất bại...”</p><p id="6">Dù nói vậy, cô bé vẫn mở to mắt, quyết tâm không để những giọt lệ rơi xuống.</p><p id="7">Trong khi tất cả chúng tôi đều cảm động trước lòng can đảm của cô bé...</p><p id="8">“Nếu em đã nói vậy, thì tôi phải nói rằng tất cả các người đều quá thiếu kinh nghiệm để được tin tưởng giao phó ngọn đồi này.” Diana cắt ngang một cách lạnh lùng. “Cố gắng cai trị nó một mình sao... Các người hẳn là đã quá tự cao về bản thân mình rồi.”</p><p id="9">“Này, Diana, cậu không cần phải nói những lời khó nghe như thế—”</p><p id="10">“Tôi đang muốn nói rằng chính vì lý do đó, ba người họ phải chung tay lại. Chỉ khi làm vậy, họ mới có đủ sức mạnh cần thiết để bảo vệ ngọn đồi. Dù sao thì, em cũng đã cứu hai người họ, Sifla. Em đã cho thấy lòng dũng cảm tuyệt vời khi đối mặt với nguy hiểm.”</p><p id="11">“...Lẽ ra cậu nên bắt đầu bằng câu đó.”</p><p id="12">“Cậu là người đã ngắt lời đấy, Akko. Cậu nên lắng nghe cho đến khi người khác nói xong.”</p><p id="13">“Rồi, tốt thôi, sao cũng được!”</p><p id="14">Diana hất mặt nhìn đi chỗ khác một cách kiêu kỳ, còn tôi thì bĩu môi. </p><p id="15"><em>Thôi nào. Cho tôi xin đi. Tôi cũng đã làm việc rất chăm chỉ mà, biết không hả.</em></p><p id="16">“Đúng như Diana nói... Từ giờ trở đi, em chắc chắn rằng ba chúng ta sẽ kết hợp sức mạnh và cùng nhau bảo vệ ngọn đồi.” Sifla nói.</p><p id="17">Tôi vẫn còn đang cảm thấy hờn dỗi, nhưng Sifla nhẹ nhàng nắm lấy tay tôi. “Cảm ơn chị, Akko. Nhờ có chị, chúng em mới có thể trở thành Vua Tiên mới.”</p><p id="18">“Hả? T-t-thật sao?”</p><p id="19">“Vâng, thật mà. Nếu không có chị, chúng em đã mỗi người một ngả rồi.”</p><p id="20">Tôi đỏ mặt.</p><p id="21">Diana khoanh tay và gật đầu một cách miễn cưỡng. “Chà, cũng có thể nói như vậy. Chuyện này cậu làm khá tốt đấy, Akko.”</p><p id="22">“D-Diana...!”</p><p id="23">“Đừng có hiểu lầm. Tôi không có khen cậu đâu. Nếu là tôi, tôi đã giải quyết xong chuyện này trước khi mọi thứ vượt khỏi tầm kiểm soát rồi!” Đôi lông mày cô ta nhíu lại, nhưng biểu cảm lại mềm mỏng hơn thường lệ.</p><p id="24"><em>Hì hì. Hì hì hì. </em>Gò má tôi giãn ra thành một nụ cười ngốc nghếch.</p><p id="25">Sifla gật đầu dứt khoát vài lần. “Em đã thực hiện được câu thần chú cuối cùng đó là vì có chị ở đó, Akko. Em không biết Chariot là ai, nhưng em chắc chắn chị sẽ trở thành một phù thủy tuyệt vời.”</p><p id="26">“Ồ, chị biết mà! Em nói đúng lắm! Sau tất cả, chị có cây gậy Shiny Rod này. Không ai khác ngoài chị có thể là Chariot tiếp theo đâu, nhỉ?!”</p><p id="27">“...Cậu hưng phấn quá đà dễ dàng thật đấy, Akko.” Sucy lầm bầm với tôi.</p><p id="28">Úi chà, tôi chắc là mình hơi quá tự cao tự đại một chút rồi. </p><p id="29"><em>Nhưng này, thỉnh thoảng hưng phấn một chút thì có sao đâu! Và hơn nữa, gần như chưa bao giờ mình được khen ngợi nhiều đến thế này!</em></p><p id="30">Feoras và Alan lặng lẽ tiến lại gần và dụi mũi vào chân tôi, như thể muốn tôi chú ý đến.</p><p id="31">“Akko, tôi thực sự biết ơn. Tất cả là nhờ cô. Lúc đầu, tôi đúng là đã nghĩ cô là một thiếu nữ nực cười, nhưng...”</p><p id="32">“Thôi nào! Nhưng sau đó tôi đã hóa ra là một thiếu nữ lộng lẫy, tuyệt vời, đúng không?!”</p><p id="33">“Phải, đúng thế... Đại loại vậy.” Feoras cười khẩy.</p><p id="34">Bên cạnh nó, Alan sủa nhẹ một tiếng. “Tôi sẽ ghi nhớ năng lượng đó của cô và cố gắng chữa bớt tính lười biếng của mình.”</p><p id="35">“Hả? Thậậật sao? Anh làm được không?”</p><p id="36">“Tôi sẽ thử. Có lẽ thế.”</p><p id="37">“Trời ạ, tôi không tin nổi chuyện đó đâu.” Amanda cười lớn. “Trước hết, đừng bắt mọi người kéo anh đi trên cái xe trượt đó nữa. Hãy giữ lấy chút phẩm giá đi.”</p><p id="38">“Hừm, chuyện đó hơi... Ồ phải rồi. Constanze.”</p><p id="39">“......?”</p><p id="40">Hắn đột nhiên hướng cuộc trò chuyện về phía cậu ấy, và cậu ấy nghiêng đầu thắc mắc.</p><p id="41">“Cô có thể chế tạo cho tôi thứ gì đó không? Ví dụ như một loại phương tiện có thể chở tôi đi khắp nơi mà vẫn giữ được phẩm giá chẳng hạn? Cô rất giỏi những thứ đó mà, phải không? Khẩu bazooka đó của cô rất ngầu.”</p><p id="42">“......!”</p><p id="43">Ồ, oa. Thật bất ngờ. Đôi mắt Constanze tỏa sáng rực rỡ. </p><p id="44">Và khuôn mặt cậu ấy thực sự trông tươi tỉnh hơn hẳn mọi khi?!</p><p id="45">Gật đầu liên tục, cậu ấy lấy một cuốn sổ từ trong túi ra và bắt đầu phác thảo bản thiết kế ngay lập tức. Alan nhìn vào đó, trông cũng rất hạnh phúc. Anh chàng bắt đầu đưa ra đủ loại yêu cầu. “Tôi muốn gắn một bát nước ở đây. Tôi muốn có một loại gối nào đó...”</p><p id="46"><em>Anh thực sự vẫn chưa rút ra được bài học nào sao...?</em></p><p id="47">“Đừng bận tâm chuyện đó. Mọi người có muốn dùng trà không? Chúng ta vẫn còn hỗn hợp trà thảo mộc mà Sifla đã giữ cho chúng ta.”</p><p id="48">Khuôn mặt Sifla là người đầu tiên bừng sáng trước đề nghị của Lotte.</p><p id="49">“Vâng! Em muốn thảo luận thêm về Đêm Tàn với chị, Lotte!” </p><p id="50">“Tất nhiên rồi! Giáo sư Ursula, chúng ta chưa phải quay về ngay đâu... đúng không ạ?” Cô bé rụt rè hỏi.</p><p id="51">Vị giáo sư lắc đầu. “Tất nhiên là không rồi.”</p><p id="52">“Hoan hô!”</p><p id="53">Khi mọi người nhảy cẫng lên, Diana khẽ cau mày. “Thật tình. Tôi ước gì các cậu bớt trẻ con đi một chút.”</p><p id="54">“Vậy chắc là cậu không muốn dùng trà hay đồ ăn nhẹ đâu nhỉ, Diana? Cậu muốn đi về trước không?”</p><p id="55">Tôi mỉa mai cô ta, và đôi lông mày cô ta nhướn lên vì giận dữ.</p><p id="56">“Tôi không có nói thế!”</p><p id="57">“Trời ạ. Cứ thành thật một lần đi mà?”</p><p id="58">“Thôi nào, thôi nào. Có đủ trà cho cả Diana nữa mà.”</p><p id="59">“Ăn chút đồ ăn nhẹ đi nào.”</p><p id="60">Khi chúng tôi tổ chức dã ngoại, cả hội cùng ngắm nhìn Đá Doras và vầng trăng. Đối với một sự kiện bột phát như vậy, bữa tiệc nhỏ của chúng tôi khá là lộng lẫy: Chúng tôi có trà, và Jasminka chuyền hết món ăn này đến món ăn khác trong khi cậu ấy đang nhét đầy miệng kẹo dẻo marshmallow.</p><p id="61">Giờ thì thực sự có cảm giác như một chuyến dã ngoại trường học rồi!</p><p id="62">Khi tôi đang trên đường đi lấy thêm trà từ chỗ Lotte, Giáo sư Ursula đã ngăn tôi lại.</p><p id="63">“Trò đã làm việc rất chăm chỉ, trò Kagari. Có thể đã có một vài vấn đề, nhưng đối với một phù thủy mới, trò chắc chắn đã làm một công việc xuất sắc.”</p><p id="64">“Lời khen từ giáo viên sao? Chuyện này chưa bao giờ xảy ra! Tuyệt quá!”</p><p id="65">“Trò đã bắt đầu hiểu được tầm quan trọng của việc nghiên cứu lịch sử pháp thuật chưa?”</p><p id="66">“Hì hì hì. Vâng, một chút ạ.”</p><p id="67">Tôi nghĩ mình có lẽ nên bắt đầu nghe các bài giảng nghiêm túc hơn một chút từ bây giờ. Chỉ là, bạn biết đấy... giọng của Giáo sư Finnelan làm tôi buồn ngủ quá.</p><p id="68">“‘Một trái tim tin tưởng chính là ma thuật của tôi.’ Trò đã vận dụng điều đó một cách tuyệt vời, trò Kagari.”</p><p id="69">“Hì hì hì hì hì. Cô cũng nghĩ vậy sao ạ?! Có phải em đang bùng nổ tài năng hay không chứ?!”</p><p id="70">Giáo sư Ursula không trả lời. Thay vào đó, bà nở một nụ cười khô khốc và ngước nhìn vầng trăng tròn.</p><p id="71">“Hơn nữa, Shiny Rod đã phản ứng với trái tim trò một lần nữa. Một người như trò... trò có lẽ sẽ làm được những điều mà tôi không thể...”</p><p id="72">“Hả?”</p><p id="73">“Ồ, không có gì đâu. Dù sao thì, làm tốt lắm. Được rồi, tôi nghĩ mình cũng sẽ đi lấy một ít trà.”</p><p id="74">Trong một khoảnh khắc, tôi nghĩ góc nghiêng của vị giáo sư trông giống như một ai đó khác dưới ánh trăng. Tôi dụi mắt. Bà ấy dường như là người mà tôi đã gặp trước đây.</p><p id="75">Ngay khi tôi định gọi bà ấy... vị giáo sư vấp phải hư không và ngã một cú trời giáng.</p><p id="76">“Ái chà! Ôi, tại sao chuyện này lúc nào cũng xảy ra với mình vậy?”</p><p id="77">Bằng cách nào đó, bà ấy đã không bị thương khi Feoras và Alan chiến đấu, nhưng tôi thề... vị giáo sư này.</p><p id="78"><em>...Đúng vậy. Bà ấy vẫn thế. Giáo sư Ursula vẫn chỉ là Giáo sư Ursula. Chắc là mình nhìn nhầm thôi. Phải, chắc chắn chỉ là do mình tưởng tượng!</em></p><p id="79">“Này, Feoras. Alan. Có muốn thử dùng sức mạnh của chúng ta để tạo ra thêm nhiều sao băng không?” Sifla gợi ý khi cô bé đang uống trà với Lotte và ngước nhìn bầu trời đêm.</p><p id="80"><img src="https://i.hako.vn/ln/chapters/illusts/297521/4ac62fb4-2770-4604-8664-95c267ba069b.jpg" alt="da92168a-8bfc-4ba8-a00f-b7546c05ce91.jpg"></p><p id="81">“Tớ không phiền đâu, nhưng... làm thế nào?” Feoras hỏi.</p><p id="82">“Chúng ta đã mất kiểm soát suốt cả buổi mà. Chúng ta vẫn không biết cách làm như thế nào.”</p><p id="83">“Có một bài hát Bà đã dạy tớ. Tớ khá chắc là hai cậu cũng biết nó. Phải không?”</p><p id="84">“...Có phải là—?”</p><p id="85">“Có phải là bài mà cả hai chúng ta đều nhớ được một phần không?”</p><p id="86">Sifla mỉm cười và gật đầu. “Bà nói khi trái tim tớ hòa làm một với loài tiên, chúng ta sẽ có thể làm cho những ngôi sao rơi xuống nếu chúng ta hát bài hát đó dưới ánh trăng tròn. Bà nói rằng bà không được dạy cho tộc mèo nhiều hơn nửa đầu và tộc chó nhiều hơn nửa sau.”</p><p id="87">“...Tớ hiểu rồi.” Đôi mắt Feoras nheo lại với một nụ cười.</p><p id="88">“Ba người như một, hửm? Nói cách khác, nó sẽ không bao giờ thành công nếu chúng ta không hợp tác.” Alan nói, dùng mũi hích vào Sifla.</p><p id="89">Cô bé đặt tách trà xuống và ôm lấy Feoras và Alan, mỗi bên một người, bằng đôi tay mảnh khảnh của mình.</p><p id="90">Nó giống hệt giấc mơ đó. Giống như ba bóng hình tôi đã thấy nép sát vào nhau. Tôi cá là đây chính là những gì Sifla đời đầu muốn thấy.</p><p id="91">“Tất cả chúng ta hãy cùng hát nhé?”</p><p id="92">Sifla bắt đầu bài hát bằng một giọng ca trong trẻo.</p><p id="93"><strong>Quý bà rừng xanh uống quả đỏ, lễ vật của người em gái.</strong></p><p id="94"><strong>Dưới tán cây nhỏ giọt nước, bầy chim líu lo gọi mùa xuân về.</strong></p><p id="95"><strong>Tắm mình dưới ánh trăng, một nàng phù thủy sẽ đến để nối lại quá khứ của loài tiên.</strong></p><p id="96"><strong>Cố nhân dõi mắt trông đồi; hoa trắng tuyết rơi dẫn lối kẻ lạc đường.</strong></p><p id="97"><strong>Ở tận cùng con đường, người ta sẽ tìm thấy lối đến thiên đường tình yêu.</strong></p><p id="98"><strong>Biến ước nguyện thành sức mạnh, và những phước lành sẽ nhảy múa trong đêm sao rơi.</strong></p><p id="99">Mỗi khi ba người họ hát đồng thanh, những ngôi sao lại rạch ngang bầu trời đêm. Cảnh tượng đó khiến tôi nín thở. Cuối cùng, họ đã trở thành Vua Tiên.</p><p id="100">Bạn biết đấy, tôi có cảm giác có lẽ chẳng có bất kỳ loại hợp đồng nào giữa Vua Tiên và Sifla đời đầu cả. Cô ấy có lẽ chỉ thuyết phục tộc Cait Sith và Cu Sith hòa thuận với nhau và quyết định rằng cả ba sẽ luôn cùng nhau bảo vệ ngọn đồi như những người bạn.</p><p id="101">Nhưng rồi vì một lý do nào đó, mọi người lại quay lại chiến đấu với nhau. Và Vua Tiên đã biến mất. Đêm nay, họ đã trở lại làm một, cùng với những cái cây thiêng.</p><p id="102">Khi chúng tôi tựa vào nhau, lặng lẽ ngước nhìn bầu trời đêm, Lotte khều tay tôi.</p><p id="103">“Này, Akko? Tớ tự hỏi.”</p><p id="104"><img src="https://i.hako.vn/ln/chapters/illusts/297521/439f2350-e600-4579-b632-71a98ea5962f.jpg" alt="875cf5b4-de1e-40c4-a80e-71afcffb183c.jpg"></p><p id="105">“Hửm? Gì thế?”</p><p id="106">“Tại sao cậu lại muốn ba người họ hòa thuận với nhau đến thế?” Cậu ấy hỏi, trông thực sự thắc mắc. “Ý tớ là, tớ cũng muốn giúp Sifla, nhưng cậu có vẻ quyết tâm một cách kỳ lạ.”</p><p id="107">“Tớ cũng tò mò về chuyện đó. Cậu có thể là một kẻ bốc đồng dễ dãi, Akko, nhưng cậu đã bỏ ra hơi nhiều nỗ lực vào việc đó đấy.”</p><p id="108"><em>Đó có phải là một lời khen không hả Sucy?</em></p><p id="109">Bắt bẻ cậu ấy sẽ chỉ làm cuộc trò chuyện kéo dài thêm, nên tôi bỏ qua. Nhưng, hừm. <em>Mình nên làm gì đây? </em>Tôi hơi ngại khi nói về chuyện này. </p><p id="110">Tuy nhiên, cả hai đều đang nhìn thẳng vào tôi, và tôi không thể cưỡng lại được nữa. Tôi gãi má một cách ngượng ngùng.</p><p id="111">“Chà, ừm, tớ đã luôn mơ ước được đến Luna Nova, và tớ đã rất mong chờ nó, nhưng tớ cũng thực sự thấy cô đơn khi đi một mình từ Nhật Bản đến tận đây. Tớ cũng thấy lo lắng nữa.”</p><p id="112">“Cậu đùa à. Cậu đã làm mọi thứ theo ý mình ngay từ đầu mà, Akko.”</p><p id="113">“Phải, và cậu còn dồn dập đến mức gây sốc nữa.”</p><p id="114">“Tớ đã thế mà! ...Nhưng vấn đề là, tớ đã xoay xở để không phải cô đơn vì đã có hai cậu ở đó. Nên là, ừ.” Tôi không nỡ nhìn thẳng vào mắt họ, nên tôi liếc nhìn đi chỗ khác. “Nói sao nhỉ? Cảm giác như nếu ba chúng ta ở bên nhau, chúng ta có thể làm được bất cứ điều gì. Ngay cả những việc mà tớ không thể tự mình làm được. Tớ nghĩ điều đó thực sự rất tuyệt vời.”</p><p id="115">“...Phải.” Lotte gật đầu, rõ ràng là đang bẽn lẽn.</p><p id="116">“Ý tớ là, chắc chắn rồi, Lotte cậu là một đứa trẻ ngoan hiền quá mức nghiêm túc, còn Sucy thì liên tục thực hiện những thí nghiệm quái đản, và thỉnh thoảng tớ cũng tự hỏi không biết các cậu bị làm sao nữa, nhưng...”</p><p id="117">“Cậu là người cuối cùng mà tớ muốn nghe điều đó đấy, Akko.” Sucy hậm hực đáp lại, nhưng tai cậu ấy đã đỏ lên một cách bất thường.</p><p id="118">“Vì vậy tớ nghĩ sẽ thật tốt nếu Sifla và hai người kia cũng có thể được như vậy! Hết chuyện!”</p><p id="119">Lotte và Sucy nhìn nhau mỉm cười.</p><p id="120">“Akko. Những ngôi sao thật đẹp, đúng không?”</p><p id="121">“...Ừ.”</p><p id="122">“Tớ đoán là tớ sẽ nể mặt cậu mà tính thuốc cây-thiêng-của-tớ là một trong những thí nghiệm của mình. Nhưng hãy chuẩn bị tinh thần cho lần cuối cùng đi.”</p><p id="123">“Thật sao?! Bây giờ cậu mới nói với tớ chuyện đó à?!”</p><p id="124">“Phải. Ý tớ là, cả chuyến phiêu lưu này làm tớ thấy hào phóng, nên tớ đã giảm xuống còn một lần nữa thôi cho cậu đấy.”</p><p id="125">“Cậu bị sao vậy Sucy?! Không thể tin được!”</p><p id="126">“Th-thôi nào. Sucy chỉ đang che giấu sự ngượng ngùng thôi. Đúng không? Phải không?”</p><p id="127">“Nói dối! Cậu ấy tuyệt đối chỉ đang thấy vui thôi!!”</p><p id="128">“Này Akko, bé cái mồm lại được không hả? Im lặng một chút đi. Chúng tớ không nghe thấy tiếng hát.”</p><p id="129">“Thật tình. Cậu thực sự không biết cách thư giãn gì cả.”</p><p id="130">“Tại sao mọi người lúc nào cũng nói với tớ như thế hả—?!”</p><p id="131">Thật không công bằng chút nào! Tôi bùng nổ trong giận dữ, nhưng mọi người chỉ nhún vai cho qua, như thể chuyện này vẫn luôn xảy ra vậy.</p><p id="132">Cứ chờ mà xem. </p><p id="133">Tôi nhất định sẽ trở thành một phù thủy tuyệt vời như Chariot, sớm nhất có thể!</p><p id="134">Khi tôi tuyên bố ý định của mình bằng tất cả sức bình sinh, một loạt sao băng vụt sáng trên bầu trời ngay trên đầu tôi.</p><p id="135"><img src="https://i.hako.vn/ln/chapters/illusts/297521/b0e6986b-7e57-484b-83dc-d7ea494a7cfa.jpg" alt="2a4dbf23-8cc5-4f84-935b-6672e4d04d63.jpg"></p>

                    <p style="display: none">Hãy bình luận để ủng hộ người đăng nhé!</p>
                    
                    <!-- <div class="flex justify-center mt-10 mb-7 space-x-3">
                        <a
                            href="https://hako.vn/discord"
                            target="_blank"
                            type="button"
                            data-te-ripple-init
                            data-te-ripple-color="light"
                            class="flex font-sans rounded px-6 py-2.5 text-xs font-medium uppercase leading-normal text-white shadow-md transition duration-150 ease-in-out hover:shadow-lg focus:shadow-lg focus:outline-none focus:ring-0 active:shadow-lg"
                            style="background-color: #7289da; text-decoration: initial; color: white !important;">
                            <svg
                                class="mr-2 h-4 w-4"
                                fill="currentColor"
                                xmlns="http://www.w3.org/2000/svg"
                                fill-rule="evenodd"
                                clip-rule="evenodd"
                                viewbox="0 0 24 24">
                                <path
                                d="M19.54 0c1.356 0 2.46 1.104 2.46 2.472v21.528l-2.58-2.28-1.452-1.344-1.536-1.428.636 2.22h-13.608c-1.356 0-2.46-1.104-2.46-2.472v-16.224c0-1.368 1.104-2.472 2.46-2.472h16.08zm-4.632 15.672c2.652-.084 3.672-1.824 3.672-1.824 0-3.864-1.728-6.996-1.728-6.996-1.728-1.296-3.372-1.26-3.372-1.26l-.168.192c2.04.624 2.988 1.524 2.988 1.524-1.248-.684-2.472-1.02-3.612-1.152-.864-.096-1.692-.072-2.424.024l-.204.024c-.42.036-1.44.192-2.724.756-.444.204-.708.348-.708.348s.996-.948 3.156-1.572l-.12-.144s-1.644-.036-3.372 1.26c0 0-1.728 3.132-1.728 6.996 0 0 1.008 1.74 3.66 1.824 0 0 .444-.54.804-.996-1.524-.456-2.1-1.416-2.1-1.416l.336.204.048.036.047.027.014.006.047.027c.3.168.6.3.876.408.492.192 1.08.384 1.764.516.9.168 1.956.228 3.108.012.564-.096 1.14-.264 1.74-.516.42-.156.888-.384 1.38-.708 0 0-.6.984-2.172 1.428.36.456.792.972.792.972zm-5.58-5.604c-.684 0-1.224.6-1.224 1.332 0 .732.552 1.332 1.224 1.332.684 0 1.224-.6 1.224-1.332.012-.732-.54-1.332-1.224-1.332zm4.38 0c-.684 0-1.224.6-1.224 1.332 0 .732.552 1.332 1.224 1.332.684 0 1.224-.6 1.224-1.332 0-.732-.54-1.332-1.224-1.332z" />
                            </svg>
                            Discord
                        </a>
                        <a
                            href="https://fb.com/hako.page"
                            target="_blank"
                            type="button"
                            data-te-ripple-init
                            data-te-ripple-color="light"
                            class="flex font-sans rounded px-6 py-2.5 text-xs font-medium uppercase leading-normal text-white shadow-md transition duration-150 ease-in-out hover:shadow-lg focus:shadow-lg focus:outline-none focus:ring-0 active:shadow-lg"
                            style="background-color: #1877f2; text-decoration: initial; color: white !important;">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="mr-2 h-4 w-4"
                                fill="currentColor"
                                viewBox="0 0 24 24">
                                <path
                                d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z" />
                            </svg>
                            Facebook
                        </a>
                    </div> -->

                                        <a href="/truyen/16221" target="__blank">
                        <img src="https://i.hako.vn/ln/series/chapter-banners/16221/29902cc6-afcf-446e-8fff-62b938eb8f8d.jpg?t=1747982730" class="d-none d-md-block" style="width: 970px; height: auto">
                    </a>
                    <a href="/truyen/16221" target="__blank">
                        <img src="https://i.hako.vn/ln/series/chapter-banners/16221/88df77ba-e124-4669-9aee-bf8635c395da.jpg?t=1747982730" class="d-md-none" style="width: 100%; height: auto">
                    </a>
                    
                                    </div>

                <div style="text-align: center; margin: 20px auto 10px auto;">
                                                        </div>
                
                <section class="rd-basic_icon row">
                    <a href="/truyen/23844-hoc-vien-phu-thuy-nho/c297517-chuong-8-mot-sai-lam-tai-hai-va-mot-con-thinh-no-khung-khiep" class="dark:text-black col text-center "><i class="fas fa-backward"></i></a>
                    <a href="/truyen/23844-hoc-vien-phu-thuy-nho" class="dark:text-black col text-center"><i class="fas fa-home"></i></a>
                    <a href="/truyen/23844-hoc-vien-phu-thuy-nho" class="dark:text-black col text-center  disabled "><i class="fas fa-forward"></i></a>
                </section>
                
                <!--the code style is important to keep this comment section be out of the effect of user reading's setting-->
            </div>
            <div class="col-12 col-lg-10 offset-lg-1" aria-hidden="true">
                <section id="chapter-comments" class="basic-section dark:bg-[#1f1f1f] dark:text-white dark:border dark:border-[#1f1f1f]">
                    <header class="sect-header tab-list dark:bg-[#2a2a2a] dark:border-[#2a2a2a]"> 
                        <span class="sect-title tab-title" data-tab-index="1">Bình luận <span class="comments-count">(0)</span></span>
                    </header>
                    <main id="fbcmt_root" class="sect-body">
                        <span style="padding: 10px; display: inline-block;">Báo cáo bình luận không phù hợp ở <a href="/thao-luan/619-bao-cao-binh-luan" style="color: blue">đây</a></span>
                        <div id="tab-content-1" class="tab-content clear">
                            <section class="ln-comment">
    <header>
        <h3 class="text-lg font-bold dark:text-white">0 Bình luận </h3>
        <!-- <i id="refresh_comment" class="fas fa-refresh" aria-hidden="true" style="margin-left: 10px; font-size: 18px"></i></h3> -->
            </header>

    <main class="ln-comment-body">
                    <div class="ln-comment_sign-in long-text">
                Bạn phải <a href="/login">đăng nhập</a> hoặc <a href="/register">tạo tài khoản</a> để bình luận.
            </div>
                
        
        
        <div class="ln-comment-page">
</div>    </main>

    <script>
        var token = 'UQQ3y51yTXj1ahdzTttriELYboo15AqDdWrHP0Yo';
        var comment_type = 'chapter';
        var comment_typeid = '297521';
    </script>

    </section>


                        </div>
                    </main>
                </section>
            </div> 
        </div>
    </div>
</main>

<script>
    token = 'TxxswE1PnG9nT2NvxUqJhcurQ8qtJDkK6eymON8a';
        
    function turnoffall() {
        $(".rdtoggle").removeClass("on");
        $(".rdtoggle_body").removeClass("animation fade-in-left-big fade-in-down");
        $("html").removeClass("overflow-hiden");
    }
    
    function rdtoggle(classicon, effect) {
        if ($(classicon).hasClass("on")) {
            turnoffall();
        } else {
            turnoffall();
            $(classicon).addClass("on");
            $("html").addClass("overflow-hiden");
            $(classicon + " .rdtoggle_body").addClass("animation " + effect);
        } 
    };
    
    $("#rd-setting_icon").on('click', function() {
        rdtoggle("#setting", "fade-in-down");                   
    });

    $("#rd-tts_icon").on('click', function() {
        rdtoggle("#tts-panel", "fade-in-down");
    });
        
    $("#rd-info_icon").on('click', function() {
        rdtoggle("#chapters", "fade-in-left-big");              
    });
        
    $("#rd-bookmark_icon").on('click', function() {
        rdtoggle("#bookmarks", "fade-in-left-big");                     
    });
        
    $(".black-click").on('click', function() {
        turnoffall();
        $("#rd-side_icon").hide();
        $("#bookmark_top").removeClass("on");
    });
        
    var bgcolor    = Cookies.get('color') || (Cookies.get('night_mode') ? 6 : 4);
    var fontfamily = Cookies.get('fontfamily') || '';
    var fontsize   = Cookies.get('font') || 18; 
    var margin     = Cookies.get('margin') || 0;
    var textAlign  = Cookies.get('textAlign') || 'text-justify';
        
    function setcolor(alter = true) {
        var switcher = $(".set-color .set-input span").eq(bgcolor);
        switcher.addClass("current");

        if (alter) {
            for (var i = 0; i < $(".set-color .set-input span").length; i++) {
                $("#mainpart").removeClass('style-' + i);
                $("#mainpart").removeClass('dark');
            }
            $("#mainpart").addClass('style-' + bgcolor);

            // Manually hardcoded to dark
            if (bgcolor >= 6) {
                $("#mainpart").addClass('dark');
            }
        }
    }

    // This creates unsmooth experience so we only use it for select box
    function setfontfamily() {
        $('.set-font-family select option').filter(function () {
            return fontfamily.split(',')[0].indexOf($(this).text()) != -1 ;
        }).attr('selected', true);
    }
        
    function setfontstyle(alter = true) {
        $(".set-font input.set-slide_input").val(fontsize + "px"); 

        if (alter) {
            $("div#chapter-content").css("font-size", fontsize + "px");

            var lineheight = +fontsize + 10;
            $("#chapter-content").css("line-height", lineheight + "px");
        }
    }
        
    function setmargin() {
        $(".set-margin input.set-slide_input").val(margin + "px"); 
        $("#chapter-content").css({
            'padding-left': margin + "px",
            'padding-right': margin + "px"
        });
    }

    function setTextAlign(alter = true) {
        var switcher = $(".set-text-align .set-input span[data-align='" + textAlign + "']");
        switcher.addClass("current");

        if (alter) {
            $(".set-text-align .set-input span").each(function () {
                $("#chapter-content").removeClass($(this).attr('data-align'));
            });

            $("#chapter-content").addClass(textAlign);
        }
    }
    
    setcolor(false);
    setfontfamily();
    setfontstyle(false);
    setmargin();
    setTextAlign(true);
    
    //1px = 0.0625rem;
    //16px = 1rem (default);
    
    $(".set-color .set-input span").click(function(){
        bgcolor = $(this).data("id");
        $(".set-color .set-input span").removeClass("current");
        setcolor();            
        Cookies.set('color', bgcolor, { expires: 365 });
    });

    $('.set-font-family select').on('change', function () {
        fontfamily = "'" + $('option:selected', this).text() + "', " + '\'Times New Roman\', Georgia, serif';
        
        $('div#chapter-content').css('font-family', fontfamily);

        Cookies.set('fontfamily', fontfamily, { expires: 365 });
    });
    
    $(".set-font .set-slide_button.set-smaller").click(function () {
        fontsize = fontsize - 2;
        if (fontsize < 0) fontsize = 0;
        setfontstyle();
        Cookies.set('font', fontsize, { expires: 365 });
    });
    
    $(".set-font .set-slide_button.set-bigger").click(function () {
        fontsize = +fontsize + 2;
        setfontstyle();
        Cookies.set('font', fontsize, { expires: 365 });
    });
    
    $(".set-margin .set-slide_button.set-smaller").click(function () {
        margin = margin - 20;
        if (margin < 0) margin = 0;
        setmargin();
        Cookies.set('margin', margin, { expires: 365 });
    });
    
    $(".set-margin .set-slide_button.set-bigger").click(function () {
        margin = +margin + 20;
        setmargin();
        Cookies.set('margin', margin, { expires: 365 });
    }); 

    $(".set-text-align .set-input span").click(function(){
        textAlign = $(this).data("align");
        $(".set-text-align .set-input span").removeClass("current");
        setTextAlign();        
        Cookies.set('textAlign', textAlign, { expires: 365 });
    });
        
    $("#bookmarks_list li").each(function(){
        var linepr = $(this).data("line");
        var preview = $(".reading-content p#" + linepr).text();

        var shortText = preview.trim().substring(0, 30) + "...";
        $(this).find(".pos_bookmark small").text(shortText);
    });

    $('div#chapter-content').html(
        $('div#chapter-content').html().replace(
            /\[note(\d+)\]/gi, 
            '<span id="anchor-note$1" class="note-icon none-print inline note-tooltip" data-tooltip-content="#note$1 .note-content" data-note-id="note$1"><i class="fas fa-sticky-note"></i></span><a id="anchor-note$1" class="inline-print none" href="#note$1">[note]</a>'
        )
    )
    
    tippy('.note-tooltip', {
        delay: 50,
        maxWidth: 240,
        interactive: true,
        content(ref) {
            const selector = ref.getAttribute('data-tooltip-content');
            const template = document.querySelector(selector);
            return template ? template.innerHTML : 'Đặt sai ID của note';
        }
    });
        
    isLoggedIn = 0;
    series_id = parseInt('23844');
    chapter_id = parseInt('297521');

    readingObject = {
        series_id: series_id,
        series_title: 'Học Viện Phù Thủy Nhỏ',
        series_url: $('i.fa-home').first().parent().attr('href'),
        series_cover: $('.rd_sidebar-header a.img').css('background-image'),
        chapter_title: $('ul.sub-chap_list li.current a').text().trim(),
        chapter_url: $('ul.sub-chap_list li.current a').attr('href'),
        book_title: $('ul#chap_list > li.current a').text(),
        book_url: $('ul#chap_list > li.current a').attr('href'),
        read_time: +new Date() / 1000 | 0,
    };

// TTS Manager - Enhanced Web Speech API (Vietnamese). Chunked queue for long texts, no delays/interrupts.
const synth = window.speechSynthesis;
let voices = [];
let voicesLoaded = false;
let ttsRate = parseFloat(localStorage.getItem('tts-rate')) || 1;
let ttsPitch = parseFloat(localStorage.getItem('tts-pitch')) || 1;
let ttsState = 'idle'; // idle, speaking, paused, loading
let currentChunk = 0;
let totalChunks = 0;
let processingIndex = 0;
let paragraphs = [];
const BUFFER_SIZE = 5;

// --- Background Persistence (Wake Lock + Silent Audio) ---
let wakeLock = null;
const silentAudio = new Audio('data:audio/mp3;base64,SUQzBAAAAAAAI1RTSVNFAAAAPAAADEVuY29kZWQgd2l0aCBMYW1lMy4xMDBhVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUA==');
silentAudio.loop = true;

async function enableConnection() {
    // 1. Start Silent Audio Loop (tricks browser into thinking we are a music player)
    try {
        await silentAudio.play();
    } catch (err) {
        console.warn('Silent Audio Play Failed (likely no interaction):', err);
    }

    // 2. Request Screen Wake Lock (prevents screen from sleeping automatically)
    if ('wakeLock' in navigator) {
        try {
            wakeLock = await navigator.wakeLock.request('screen');
        } catch (err) {
            console.warn('Wake Lock Request Failed:', err);
        }
    }
}

function disableConnection() {
    // 1. Stop Silent Audio
    try {
        silentAudio.pause();
        silentAudio.currentTime = 0;
    } catch (e) {}

    // 2. Release Wake Lock
    if (wakeLock) {
        try {
            wakeLock.release();
            wakeLock = null;
        } catch (e) {}
    }
}

// Re-acquire Wake Lock if visibility changes and we are speaking
document.addEventListener('visibilitychange', async () => {
    if (wakeLock !== null && document.visibilityState === 'visible' && ttsState === 'speaking') {
        try {
            wakeLock = await navigator.wakeLock.request('screen');
        } catch (e) {}
    }
});
// ---------------------------------------------------------

let ttsVoiceIdx = localStorage.getItem('tts-voice') || '0';

function populateVoices() {
    voices = synth.getVoices().filter(v => v.lang.startsWith('vi'));
    voicesLoaded = true;
    let $select = $('#tts-voice-select');
    $select.empty();

    if (voices.length === 0) {
        $select.append('<option value="-1">Không có giọng Việt (cài Chrome/Edge)</option>');
        return;
    }

    voices.forEach((voice, idx) => {
        $select.append(`<option value="${idx}">${voice.name} (${voice.lang}) ${voice.default ? '(mặc định)' : ''}</option>`);
    });

    let idx = Math.max(0, Math.min(parseInt(ttsVoiceIdx), voices.length - 1));
    $select.val(idx);
}

function updateTTSUI(progress = '') {
    let $icon = $('#rd-tts_icon i');
    $icon.removeClass('fa-volume-up fa-volume-mute fa-spinner fa-spin');
    let $playBtn = $('#tts-play-btn'), $pauseBtn = $('#tts-pause-btn'), $stopBtn = $('#tts-stop-btn');
    $playBtn.prop('disabled', ttsState === 'speaking' || ttsState === 'loading'); // Enable on idle/paused
    $pauseBtn.prop('disabled', ttsState === 'idle');
    $stopBtn.prop('disabled', ttsState === 'idle');
    // Always remove old progress
    $('#tts-progress').remove();

    if (progress && totalChunks > 0) {
        $playBtn.after(`<span id="tts-progress" class="text-xs block text-center mt-1">${progress}</span>`);
    }

    if (ttsState === 'idle') {
        // Check resume preview
        const resumeData = loadResumeState();
        let currentParagraphs = $('#chapter-content p').map(function() {
            return $(this).text().trim();
        }).get().filter(p => p.trim().length > 0);

        if (resumeData && resumeData.total === currentParagraphs.length) {
            $playBtn.text(`Tiếp tục (${resumeData.index + 1}/${resumeData.total})`);
        } else {
            $playBtn.text('Phát');
        }

        $icon.addClass('fa-volume-up');
    } else if (ttsState === 'speaking' || ttsState === 'loading') {
        $icon.addClass('fa-volume-up fa-spinner fa-spin');
    } else if (ttsState === 'paused') {
        $icon.addClass('fa-volume-mute');
    }
}

$('#tts-play-btn').off('click').on('click', function() {
    // Always restart/resume from storage
    enableConnection(); // Start keep-alive
    synth.cancel();
    ttsState = 'idle';
    // queuedUtterances = []; // Removed global queue
    currentChunk = 0;
    totalChunks = 0;
    processingIndex = 0;
    updateTTSUI();

    if (!voicesLoaded || voices.length === 0) {
        ttsState = 'loading';
        updateTTSUI();
        setTimeout(() => {
            if (!voicesLoaded) {
                alert('Giọng nói chưa tải. Thử lại.');
                ttsState = 'idle';
                updateTTSUI();
                return;
            }
            playTTS();
        }, 500);
        return;
    }

    playTTS();
});

function createUtterance(item) {
    let u = new SpeechSynthesisUtterance(item.text);
    u.lang = 'vi-VN';
    u.rate = parseFloat($('#tts-rate').val()) || 1;
    u.pitch = parseFloat($('#tts-pitch').val()) || 1;
    let voiceIdx = parseInt($('#tts-voice-select').val());

    if (voiceIdx >= 0 && voices[voiceIdx]) {
        u.voice = voices[voiceIdx];
    }

    u.onstart = () => {
        currentChunk++;
        saveResumeState();
        updateTTSUI(`${currentChunk}/${totalChunks}`);
        
        // Highlight logic
        $('.current-reading').removeClass('current-reading');
        if (item.el) {
            $(item.el).addClass('current-reading');
            item.el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        feedQueue(); // Ensure buffer is maintained
    };
    u.onerror = (event) => {
        console.error('TTS Error:', event.error, event);

        if (event.error !== 'interrupted') {
             // alert(`Lỗi TTS: ${event.error}. Bỏ qua đoạn.`);
             console.warn('TTS Error skipping chunk', event.error);
        }

        saveResumeState(); // Save on error
        feedQueue();
    };
    u.onend = () => {
        saveResumeState();

        if (currentChunk >= totalChunks) {
            clearResumeState();
            $('.current-reading').removeClass('current-reading'); // Cleanup
            
            // Auto-Next Logic
            let $nextBtn = $('.rd-basic_icon a').last();
            if ($nextBtn.length && !$nextBtn.hasClass('disabled')) {
                localStorage.setItem('tts-autoplay', 'true');
                window.location.href = $nextBtn.attr('href');
                return;
            }

            ttsState = 'idle';
            disableConnection(); // Cleanup
            currentChunk = 0;
            totalChunks = 0;
            processingIndex = 0;
            updateTTSUI();
        } else {
            feedQueue();
        }
    };
    u.onpause = () => { saveResumeState(); };
    return u;
}

function getStorageData() {
    try {
        return JSON.parse(localStorage.getItem('tts-resume-data')) || {};
    } catch {
        return {};
    }
}

function setStorageData(data) {
    localStorage.setItem('tts-resume-data', JSON.stringify(data));
}

function saveResumeState() {
    if (totalChunks > 0) {
        const data = getStorageData();
        data[chapter_id] = {
            index: currentChunk,
            total: totalChunks,
            timestamp: Date.now()
        };
        // Optional: Clean up old entries (older than 7 days?) to prevent infinite growth, 
        // but for now we just save.
        setStorageData(data);
    }
}

function clearResumeState() {
    const data = getStorageData();

    if (data[chapter_id]) {
        delete data[chapter_id];
        setStorageData(data);
    }
}

function loadResumeState() {
    const data = getStorageData();
    const saved = data[chapter_id];
    
    if (!saved) return null;
    
    if (Date.now() - saved.timestamp > 3600000 * 24 * 7) { // 7 days
        clearResumeState();
        return null;
    }

    return saved;
}

function initTTS() {
    populateVoices();
    $('#tts-rate').val(ttsRate);
    $('#tts-rate-value').text(ttsRate);
    $('#tts-pitch').val(ttsPitch);
    $('#tts-pitch-value').text(ttsPitch);
    updateTTSUI();
    
    if (localStorage.getItem('tts-autoplay') === 'true') {
        localStorage.removeItem('tts-autoplay');
        $(window).on('load', function() {
             setTimeout(() => {
                 $('#tts-play-btn').click(); 
             }, 500); 
        });
    }
}

function getParagraphs() {
    return $('#chapter-content p').map(function() {
        let text = $(this).text().trim();
        
        // If paragraph contains an image, replace with "Hình ảnh"
        if ($(this).find('img').length > 0) {
            text = 'Hình ảnh';
        }
        
        if (text.length > 0) {
            return { text: text, el: this };
        }
    }).get();
}

function feedQueue() {
    if (ttsState !== 'speaking') return;
    
    // Maintain buffer
    while (processingIndex < totalChunks && processingIndex < currentChunk + BUFFER_SIZE) {
        let u = createUtterance(paragraphs[processingIndex]);
        synth.speak(u);
        processingIndex++;
    }
}

function playTTS() {
    paragraphs = getParagraphs();
    if (paragraphs.length === 0) {
        alert('Không có nội dung để đọc.');
        ttsState = 'idle';
        disableConnection(); // Cleanup
        updateTTSUI();
        return;
    }
    
    const resumeData = loadResumeState();
    if (resumeData && resumeData.total === paragraphs.length) {
        currentChunk = resumeData.index;
        totalChunks = resumeData.total;
        // processingIndex needs to match what we are about to play
        // Current chunk is what finished, so we start processing from currentChunk?
        // Wait, currentChunk is "index of just finished" in some contexts?
        // No, in loadResume, index is currentChunk.
        // If saved index is 5. means 0..4 played.
        // We start playing from 5 (index).
        // So processingIndex = currentChunk.
        processingIndex = currentChunk;
    } else {
        clearResumeState();
        currentChunk = 0;
        totalChunks = paragraphs.length;
        processingIndex = 0;
    }
    
    synth.cancel();
    ttsState = 'speaking';
    
    feedQueue();
    updateTTSUI(`${currentChunk + 1}/${totalChunks}`);
}

$('#tts-rate').on('input', function() {
    $('#tts-rate-value').text(this.value);
    localStorage.setItem('tts-rate', this.value);
});

$('#tts-pitch').on('input', function() {
    $('#tts-pitch-value').text(this.value);
    localStorage.setItem('tts-pitch', this.value);
});

$('#tts-voice-select').on('change', function() {
    localStorage.setItem('tts-voice', this.value);
});

$('#tts-pause-btn').off('click').on('click', function() {
    if (ttsState === 'speaking') {
        synth.pause();
        ttsState = 'paused';
        disableConnection(); // Pause keep-alive
        updateTTSUI();
        saveResumeState();
    } else if (ttsState === 'paused') {
        enableConnection(); // Resume keep-alive
        synth.resume();
        ttsState = 'speaking';
        updateTTSUI();
    }
});

$('#tts-stop-btn').off('click').on('click', function() {
    synth.cancel();
    // clearResumeState(); // Stop doesn't necessarily clear resume, usually just pause? 
    // But UI says "Stop". Let's clear resume state to consistent with old behavior 
    // or maybe optional? Old behavior cleared it.
    clearResumeState();
    
    disableConnection(); // Stop keep-alive
    $('.current-reading').removeClass('current-reading'); // Cleanup
    ttsState = 'idle';
    currentChunk = 0;
    totalChunks = 0;
    processingIndex = 0;
    updateTTSUI();
});

// Visibility handler removed - TTS continues on tab switch

// Long-press to start TTS from selected paragraph (500ms hold)
let longPressTimer = null;
let longPressTarget = null;

// $('#chapter-content p').on('touchstart mousedown', function(e) {
//     longPressTarget = this;
//     longPressTimer = setTimeout(() => {
//         const allParagraphs = getParagraphs();
//         const startIndex = allParagraphs.findIndex(p => p.el === longPressTarget);

//         if (startIndex === -1) return;

//         clearResumeState();
//         synth.cancel();
        
//         paragraphs = allParagraphs;
//         currentChunk = startIndex;
//         totalChunks = paragraphs.length;
//         processingIndex = startIndex;
//         ttsState = 'speaking';
        
//         enableConnection();
//         feedQueue();
//         updateTTSUI(`${currentChunk + 1}/${totalChunks}`);
//     }, 500);
// }).on('touchend touchmove mouseup mouseleave', function() {
//     clearTimeout(longPressTimer);
//     longPressTimer = null;
// });

synth.onvoiceschanged = populateVoices;
initTTS();


</script>





    
    <script src="/scripts/service-manager.js?r=4"></script>

    <script src="/scripts/app.js?id=a5a24eca66adcfc75cc0b2f62e2611db"></script>
    <script src="https://docln.net/vendor/livewire/livewire.min.js?id=df3a17f2"   data-csrf="TxxswE1PnG9nT2NvxUqJhcurQ8qtJDkK6eymON8a" data-update-uri="/livewire/update" data-navigate-once="true"></script>

    
    <script src="https://confidecross.com/d5/6b/4b/d56b4bd6c3d2c1e161c4ab3c78c27670.js" async></script>

        
            <footer id="footer">
    <div class="container">
        <!--<span><a href="">Hako.re</a></span>-->
        <span class="right">Liên hệ: <a href="mailto:contact@hako.vn" target="_blank" style="color: #5fff46">contact@hako.vn</a></span>

        <span>© 2016 - 2026 Cổng Light Novel - Đọc Light Novel</span>
    </div>
</footer>    
    <div x-data x-show="$store.toast.on" @click="$store.toast.hide()" class="bg-teal-100 border-t-4 border-teal-500 rounded-b text-teal-900 px-4 py-3 shadow-md fixed w-3/4 md:w-1/2 z-20 inset-x-0 bottom-10 mx-auto" role="alert" style="display: none">
    <div class="flex">
        <div class="py-1"><svg class="fill-current h-6 w-6 text-teal-500 mr-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z"/></svg></div>
        <div>
            <p class="font-bold capitalize">Chú ý</p>
            <p class="text-sm" x-text="$store.toast.message"></p>
        </div>
    </div>
</div><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c3e9bf4ac74d116',t:'MTc2OTQxNTgxNg=='};var a=document.createElement('script');a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
